import{e as J,f as O,g as i,h as n,a as s,r as u,w as r,B as d,U as I,k as a,A as B,E as b,D as R,L as V,C as c,F as _,q as D,aA as Q,aB as W,S as Y,l as Z,z as M,n as ee,p as se,G as F,t as S,o,c as y,O as te,m as ae,v as le,aD as ne,a8 as oe,H as re}from"./index-nbuW1C-Z.js";import{A as ie}from"./SidebarAdmin-CYotWZnb.js";import{R as de}from"./refresh-cw-BOusI3zc.js";import{S as H}from"./shield-BaoCScyT.js";import{U as N}from"./users-B12xvqD0.js";import{S as ce}from"./square-pen-LtN7h1ME.js";import"./file-text-Qj2K4aNE.js";import"./settings-D7S0Yl72.js";const ue=J("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),pe={class:"min-h-screen bg-stone-100"},me={class:"flex items-center gap-2 text-xs font-mono uppercase tracking-wider mb-4"},ge={key:0,class:"flex items-center justify-center py-20"},fe={key:1,class:"bg-red-50 border-2 border-red-300 p-6 text-center"},xe={class:"text-red-600 text-sm mb-4"},ve={class:"mb-8"},be={class:"text-lg font-bold uppercase tracking-wider mb-4 flex items-center gap-2"},_e={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4"},ye={class:"flex items-center justify-between mb-3"},ke={class:"text-xs text-stone-500 bg-stone-100 px-2 py-1 border border-stone-300"},he={class:"text-xs text-stone-600 mb-3"},we={class:"flex items-center gap-1 text-xs text-stone-500"},Ce={class:"flex flex-col xl:flex-row xl:items-center xl:justify-between gap-4"},Re={class:"flex items-center gap-3"},Ue={class:"flex flex-col sm:flex-row gap-3"},Ae={class:"relative"},Be={class:"lg:col-span-4 flex items-center gap-3"},De={class:"w-10 h-10 bg-stone-200 border-2 border-stone-800 shadow-brutal-sm flex items-center justify-center text-sm font-bold overflow-hidden"},Se=["src","alt"],$e={key:1},ze={class:"font-bold text-sm"},Le={class:"text-xs text-stone-500"},je={class:"lg:col-span-2"},Pe=["value"],Ie={class:"lg:col-span-3"},Ve={class:"text-sm text-stone-600"},Me={class:"lg:col-span-3 flex justify-start lg:justify-end gap-2"},Fe={key:0,class:"px-6 py-12 text-center"},Oe={__name:"RBAC",setup(He){const k=u(""),$=u(!1),h=u([]),p=u([]),f=u(!0),w=u(null),x=u(null),C=u(null),m=u(null),{showToast:z}=re(),T={admin:"bg-red-100 text-red-800 border-red-300",moderator:"bg-orange-100 text-orange-800 border-orange-300",creator:"bg-blue-100 text-blue-800 border-blue-300",user:"bg-green-100 text-green-800 border-green-300"};async function U(){f.value=!0,w.value=null;try{const[l,e]=await Promise.all([S.get("/api/auth/roles"),S.get("/api/auth/users")]);h.value=l.data||[],p.value=e.data||[]}catch(l){console.error("Failed to fetch RBAC data:",l),w.value=l.message||"Gagal memuat data"}finally{f.value=!1}}const L=se(()=>{if(!k.value)return p.value;const l=k.value.toLowerCase();return p.value.filter(e=>e.name?.toLowerCase().includes(l)||e.email?.toLowerCase().includes(l)||e.role?.name?.toLowerCase().includes(l))}),j=l=>T[l]||"bg-stone-100 text-stone-800 border-stone-300",q=l=>p.value.filter(e=>e.role_id===l).length;function E(l){C.value=l.id,m.value=l.role_id}function P(){C.value=null,m.value=null}async function G(l){if(m.value){x.value=l;try{const e=await S.patch(`/api/auth/users/${l}/role`,{role_id:m.value}),v=p.value.findIndex(t=>t.id===l);v!==-1&&e.data&&(p.value[v]=e.data),P();const A=h.value.find(t=>t.role_id===parseInt(m.value))?.name;z(`Peran pengguna diperbarui menjadi ${A||"role baru"}`)}catch(e){console.error("Failed to update role:",e),z(e.message||"Gagal memperbarui peran","error")}finally{x.value=null}}}function K(l){if(!l)return"?";const e=l.split(" ");return e.length>=2?(e[0][0]+e[1][0]).toUpperCase():l.substring(0,2).toUpperCase()}function X(l){return l?new Date(l).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"}):"-"}return O(()=>{U()}),(l,e)=>{const v=I("router-link"),A=I("PageHeader");return o(),i("div",pe,[n(ie,{"onUpdate:collapsed":e[0]||(e[0]=t=>$.value=t)}),s("main",{class:R(["p-4 md:p-8 transition-all duration-300",$.value?"ml-14":"ml-56"])},[s("nav",me,[n(v,{to:"/",class:"text-brand-teal hover:underline"},{default:r(()=>[...e[3]||(e[3]=[d("Beranda",-1)])]),_:1}),e[6]||(e[6]=s("span",{class:"text-stone-400"},"/",-1)),n(v,{to:"/admin",class:"text-stone-600 hover:underline"},{default:r(()=>[...e[4]||(e[4]=[d("Administrasi",-1)])]),_:1}),e[7]||(e[7]=s("span",{class:"text-stone-400"},"/",-1)),n(a(B),{variant:"outline",class:"bg-orange-100 text-orange-700 border-orange-300"},{default:r(()=>[...e[5]||(e[5]=[d(" Kontrol Akses ",-1)])]),_:1})]),n(A,{title:"Pengaturan Hak Akses",description:"Kelola role dan izin pengguna untuk sistem PF Space.",icon:a(H),"icon-color":"bg-amber-500"},{actions:r(()=>[n(a(b),{onClick:U,disabled:f.value,class:"gap-2"},{default:r(()=>[n(a(de),{class:R(["w-4 h-4",f.value&&"animate-spin"])},null,8,["class"]),e[8]||(e[8]=d(" Refresh ",-1))]),_:1},8,["disabled"])]),_:1},8,["icon"]),f.value?(o(),i("div",ge,[n(a(V),{class:"w-8 h-8 animate-spin text-brand-teal"}),e[9]||(e[9]=s("span",{class:"ml-3 text-stone-600"},"Memuat data...",-1))])):w.value?(o(),i("div",fe,[e[11]||(e[11]=s("p",{class:"text-red-800 font-bold mb-2"},"Gagal Memuat Data",-1)),s("p",xe,c(w.value),1),n(a(b),{onClick:U,variant:"outline"},{default:r(()=>[...e[10]||(e[10]=[d("Coba Lagi",-1)])]),_:1})])):(o(),i(_,{key:2},[s("section",ve,[s("h2",be,[n(a(H),{class:"w-5 h-5"}),e[12]||(e[12]=d(" Daftar Role ",-1))]),s("div",_e,[(o(!0),i(_,null,D(h.value,t=>(o(),y(a(F),{key:t.role_id,class:"hover:shadow-brutal transition-shadow"},{default:r(()=>[n(a(M),{class:"p-4"},{default:r(()=>[s("div",ye,[n(a(B),{class:R([j(t.name),"font-bold capitalize"]),variant:"outline"},{default:r(()=>[d(c(t.name),1)]),_:2},1032,["class"]),s("span",ke," ID: "+c(t.role_id),1)]),s("p",he,c(t.description||"Tidak ada deskripsi"),1),s("div",we,[n(a(N),{class:"w-3 h-3"}),d(" "+c(q(t.role_id))+" pengguna ",1)])]),_:2},1024)]),_:2},1024))),128))])]),n(a(F),null,{default:r(()=>[n(a(Q),{class:"bg-stone-50 border-b-2 border-stone-800"},{default:r(()=>[s("div",Ce,[s("div",Re,[n(a(N),{class:"w-5 h-5"}),n(a(W),{class:"text-lg font-bold uppercase"},{default:r(()=>[d(" Manajemen Pengguna ("+c(p.value.length)+" pengguna) ",1)]),_:1})]),s("div",Ue,[s("div",Ae,[n(a(Y),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-stone-400"}),n(a(Z),{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=t=>k.value=t),placeholder:"Cari pengguna...",class:"pl-10 w-full sm:w-64"},null,8,["modelValue"])])])])]),_:1}),n(a(M),{class:"p-0"},{default:r(()=>[e[19]||(e[19]=s("div",{class:"hidden lg:grid grid-cols-12 gap-4 px-6 py-3 bg-lime-50 border-b-2 border-stone-800 text-xs font-bold uppercase tracking-wider"},[s("div",{class:"col-span-4"},"Pengguna"),s("div",{class:"col-span-2"},"Role"),s("div",{class:"col-span-3"},"Bergabung"),s("div",{class:"col-span-3 text-right"},"Aksi")],-1)),(o(!0),i(_,null,D(L.value,t=>(o(),i("div",{key:t.id,class:"grid grid-cols-1 lg:grid-cols-12 gap-4 px-6 py-4 items-center border-b border-stone-200 hover:bg-stone-50"},[s("div",Be,[s("div",De,[t.image?(o(),i("img",{key:0,src:a(te)(t.image),alt:t.name,class:"w-full h-full object-cover"},null,8,Se)):(o(),i("span",$e,c(K(t.name)),1))]),s("div",null,[s("p",ze,c(t.name),1),s("p",Le,c(t.email),1)])]),s("div",je,[e[13]||(e[13]=s("span",{class:"lg:hidden text-xs text-stone-500 uppercase mr-2"},"Role:",-1)),C.value!==t.id?(o(),y(a(B),{key:0,class:R([j(t.role?.name),"font-bold capitalize"]),variant:"outline"},{default:r(()=>[d(c(t.role?.name||"Unknown"),1)]),_:2},1032,["class"])):ae((o(),i("select",{key:1,"onUpdate:modelValue":e[2]||(e[2]=g=>m.value=g),class:"text-xs border-2 border-stone-800 px-2 py-1 bg-white focus:outline-none focus:ring-2 focus:ring-brand-teal"},[(o(!0),i(_,null,D(h.value,g=>(o(),i("option",{key:g.role_id,value:g.role_id},c(g.name),9,Pe))),128))],512)),[[le,m.value]])]),s("div",Ie,[e[14]||(e[14]=s("span",{class:"lg:hidden text-xs text-stone-500 uppercase mr-2"},"Joined:",-1)),s("span",Ve,c(X(t.createdAt)),1)]),s("div",Me,[C.value!==t.id?(o(),y(a(b),{key:0,onClick:g=>E(t),variant:"outline",size:"sm",class:"gap-1 text-xs"},{default:r(()=>[n(a(ce),{class:"w-3 h-3"}),e[15]||(e[15]=d(" Ubah Role ",-1))]),_:1},8,["onClick"])):(o(),i(_,{key:1},[n(a(b),{onClick:g=>G(t.id),disabled:x.value===t.id,size:"sm",class:"gap-1 text-xs bg-green-600 hover:bg-green-700"},{default:r(()=>[x.value===t.id?(o(),y(a(V),{key:0,class:"w-3 h-3 animate-spin"})):(o(),y(a(ne),{key:1,class:"w-3 h-3"})),e[16]||(e[16]=d(" Simpan ",-1))]),_:2},1032,["onClick","disabled"]),n(a(b),{onClick:P,disabled:x.value===t.id,variant:"outline",size:"sm",class:"gap-1 text-xs"},{default:r(()=>[n(a(oe),{class:"w-3 h-3"}),e[17]||(e[17]=d(" Batal ",-1))]),_:1},8,["disabled"])],64))])]))),128)),L.value.length===0?(o(),i("div",Fe,[n(a(ue),{class:"w-12 h-12 text-stone-300 mx-auto mb-4"}),e[18]||(e[18]=s("p",{class:"text-stone-500"},"Tidak ada pengguna yang cocok dengan pencarianmu.",-1))])):ee("",!0)]),_:1})]),_:1})],64))],2)])}}};export{Oe as default};
