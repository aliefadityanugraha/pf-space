import{e as me,J as xe,a5 as J,u as fe,f as ve,ad as he,r as n,c as f,w as d,a as t,h as a,g as b,n as w,k as s,V as B,C as i,B as c,p as O,A as S,D as E,aC as we,aD as q,z as N,a8 as R,G as H,ac as Q,E as g,a9 as ge,aA as ye,F as ke,q as _e,l as V,L as W,O as Ce,aE as Pe,H as je,a7 as Ve,t as y,o as l}from"./index-CdiZ0yiz.js";import{_ as $e}from"./PageLayout-CDEHN9R7.js";import{_ as De,T as X}from"./LoadingState-BcAME5so.js";const Fe=me("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),Te={class:"max-w-7xl mx-auto mb-16"},Ue={class:"flex flex-col md:flex-row items-center gap-6 mb-8 p-6 bg-white border-2 border-black shadow-brutal relative z-10"},Ae={class:"relative group flex-shrink-0"},Ie={class:"w-24 h-24 border-2 border-black bg-stone-200 overflow-hidden shadow-sm relative"},Le=["src","alt"],Se={key:1,class:"w-full h-full flex items-center justify-center bg-brand-teal/20"},Ke={class:"flex-1 text-center md:text-left"},ze={class:"flex flex-col md:flex-row items-center gap-3 mb-1 justify-center md:justify-start"},Be={class:"text-3xl font-display font-bold text-stone-900 uppercase tracking-wide"},Ee={class:"text-stone-600 text-sm font-medium border-b-2 border-dashed border-stone-300 inline-block pb-1 mb-2"},Ne={class:"flex items-center justify-center md:justify-start gap-2 text-xs font-bold uppercase tracking-widest text-stone-400 mt-1"},Re={key:0,class:"flex gap-2 border-l-2 border-black pl-6 hidden md:flex"},He={class:"text-center px-4"},Me={class:"text-2xl font-display font-bold text-stone-900"},Ge={class:"text-center px-4 border-l-2 border-dashed border-stone-300"},Je={class:"text-2xl font-display font-bold text-stone-900"},Oe={class:"flex gap-4 mb-8 overflow-x-auto pb-2"},qe={key:0},Qe={key:0},We={key:1,class:"space-y-8 animate-fade-in"},Xe={class:"grid grid-cols-1 sm:grid-cols-3 gap-4"},Ye={class:"w-12 h-12 bg-stone-100 border-2 border-black flex items-center justify-center mb-3 shadow-sm"},Ze={class:"text-4xl font-display font-bold text-stone-900 mb-1"},et={class:"w-12 h-12 bg-brand-teal/20 border-2 border-black flex items-center justify-center mb-3 shadow-sm"},tt={class:"text-4xl font-display font-bold text-stone-900 mb-1"},st={class:"w-12 h-12 bg-brand-orange/20 border-2 border-black flex items-center justify-center mb-3 shadow-sm"},at={class:"text-4xl font-display font-bold text-stone-900 mb-1"},ot={class:"flex items-center justify-between mb-4 border-b-2 border-black pb-2"},lt={key:0,class:"text-center py-12 border-2 border-dashed border-stone-400 bg-stone-50/50"},rt={key:1,class:"space-y-4"},nt={class:"w-12 h-16 bg-stone-200 flex-shrink-0 overflow-hidden border border-black relative"},dt=["src"],it={key:1,class:"w-full h-full flex items-center justify-center bg-stone-100"},ut={class:"flex-1 min-w-0"},bt={class:"font-display font-bold text-stone-900 truncate uppercase"},ct={class:"text-xs font-mono text-stone-500 mb-2 border-b border-dashed border-stone-200 pb-1 w-fit"},pt={class:"text-right flex flex-col gap-2"},mt={key:1,class:"text-center py-16 border-2 border-black bg-white shadow-brutal"},xt={class:"w-20 h-20 bg-brand-orange border-2 border-black flex items-center justify-center mx-auto mb-6 shadow-brutal"},ft={class:"flex justify-center gap-4"},vt={key:1,class:"animate-fade-in max-w-7xl mx-auto space-y-8"},ht={class:"bg-white p-6 border-2 border-black shadow-brutal relative"},wt={class:"font-display font-bold text-xl text-stone-900 mb-6 border-b-2 border-black pb-2 flex items-center gap-2"},gt={class:"space-y-6"},yt={class:"pt-2"},kt={class:"bg-white p-6 border-2 border-black shadow-brutal relative"},_t={class:"font-display font-bold text-xl text-stone-900 mb-6 border-b-2 border-black pb-2 flex items-center gap-2"},Ct={class:"space-y-6"},Pt={class:"relative"},jt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Vt={class:"pt-2"},$t={__name:"Profile",setup(Dt){const k=ge(),{user:p,refreshUser:Y,initialized:Z,isLoggedIn:ee,isCreator:K}=he(),{toast:$,showToast:_}=je(),M=n(null),v=n("dashboard");J([Z,ee],([r,e])=>{r&&!e&&k.push("/auth/login")},{immediate:!0}),fe({title:()=>p.value?`Profil: ${p.value.name} - PF Space`:"Profil Saya - PF Space"});const C=n(""),D=n(""),P=n(""),F=n(""),T=n(!1),te=n(!1),se=n(!1),U=n(!1),A=n(!1);J(p,r=>{r&&(C.value=r.name||"")},{immediate:!0});const ae=O(()=>p.value?.role?.name||"user"),oe=O(()=>p.value?.created_at?new Date(p.value.created_at).toLocaleDateString("id-ID",{month:"long",year:"numeric"}):"Unknown"),j=n(null),z=n(null),I=n(!0),G=n(""),L=n([]),h=n({totalFilms:0,pending:0,published:0,rejected:0,totalVotes:0,totalComments:0}),le={pending:"bg-yellow-100 text-yellow-900 border-yellow-900",published:"bg-brand-teal text-white border-black",rejected:"bg-brand-red text-white border-black"},re={pending:"Menunggu Review",published:"Dipublikasi",rejected:"Ditolak"},ne=async()=>{I.value=!0,G.value="";try{const r=await y.get("/api/films/my-films",{params:{page:1,limit:10}}),e=Array.isArray(r.data)?r.data:[],o={};e.length>0&&await Promise.all(e.map(async u=>{const m=u.film_id;try{const[ce,pe]=await Promise.all([y.get(`/api/votes/film/${m}`),y.get(`/api/discussions/film/${m}/count`)]);o[m]={vote_count:ce.data?.vote_count??0,comment_count:pe.data?.comment_count??0}}catch{o[m]={vote_count:0,comment_count:0}}}));const x=e.map(u=>{const m=o[u.film_id]||{};return{...u,vote_count:m.vote_count||0,comment_count:m.comment_count||0}});L.value=x,h.value={totalFilms:x.length,pending:x.filter(u=>u.status==="pending").length,published:x.filter(u=>u.status==="published").length,rejected:x.filter(u=>u.status==="rejected").length,totalVotes:x.reduce((u,m)=>u+(m.vote_count||0),0),totalComments:x.reduce((u,m)=>u+(m.comment_count||0),0)}}catch(r){G.value="Gagal memuat data dashboard.",console.error(r)}finally{I.value=!1}},de=()=>{M.value.click()},ie=r=>{const e=r.target.files[0];if(e){j.value=e;const o=new FileReader;o.onload=x=>{z.value=x.target.result},o.readAsDataURL(e)}},ue=async()=>{U.value=!0;try{const r=new FormData;r.append("name",C.value),j.value&&r.append("image",j.value),j.value?await y.upload("/api/auth/update-user",r,{method:"PATCH"}):await y.patch("/api/auth/update-user",{name:C.value}),await Y(),_("Profil berhasil diperbarui!","success"),j.value=null}catch(r){_(r.message||"Gagal memperbarui profil","error")}finally{U.value=!1}},be=async()=>{if(P.value!==F.value){_("Password tidak cocok","error");return}A.value=!0;try{await y.post("/api/auth/change-password",{currentPassword:D.value,newPassword:P.value}),D.value="",P.value="",F.value="",_("Password berhasil diubah!","success")}catch(r){_(r.message||"Gagal mengubah password","error")}finally{A.value=!1}};return ve(()=>{K.value?ne():I.value=!1}),(r,e)=>(l(),f($e,null,{default:d(()=>[t("div",Te,[t("div",Ue,[e[14]||(e[14]=t("div",{class:"absolute top-2 right-2 flex gap-1"},[t("div",{class:"w-2 h-2 bg-black rounded-full"}),t("div",{class:"w-2 h-2 bg-black rounded-full"})],-1)),t("div",Ae,[t("input",{type:"file",ref_key:"fileInput",ref:M,class:"hidden",accept:"image/*",onChange:ie},null,544),t("div",Ie,[z.value||s(p)?.image?(l(),b("img",{key:0,src:z.value||s(p).image,alt:s(p)?.name,class:"w-full h-full object-cover"},null,8,Le)):(l(),b("div",Se,[a(s(B),{class:"w-10 h-10 text-stone-900"})]))]),t("button",{onClick:de,class:"absolute -bottom-2 -right-2 w-8 h-8 bg-brand-teal border-2 border-black flex items-center justify-center hover:translate-x-[1px] hover:translate-y-[1px] transition-transform cursor-pointer shadow-brutal-sm",title:"Ganti Foto"},[a(s(Fe),{class:"w-4 h-4 text-white"})])]),t("div",Ke,[t("div",ze,[t("h1",Be,i(s(p)?.name||"User"),1),a(s(S),{variant:"outline",class:"capitalize border-2 border-black bg-brand-orange text-stone-900 font-bold shadow-brutal-sm"},{default:d(()=>[c(i(ae.value),1)]),_:1})]),t("p",Ee,i(s(p)?.email),1),t("div",Ne,[t("span",null,"Bergabung "+i(oe.value),1)])]),s(K)?(l(),b("div",Re,[t("div",He,[t("div",Me,i(h.value.totalFilms),1),e[12]||(e[12]=t("div",{class:"text-[10px] uppercase font-bold text-stone-500 tracking-widest"},"Karya",-1))]),t("div",Ge,[t("div",Je,i(h.value.totalVotes),1),e[13]||(e[13]=t("div",{class:"text-[10px] uppercase font-bold text-stone-500 tracking-widest"},"Vote",-1))])])):w("",!0)]),t("div",Oe,[t("button",{onClick:e[0]||(e[0]=o=>v.value="dashboard"),class:E(["px-6 py-3 font-display font-bold uppercase tracking-widest text-sm border-2 border-black transition-all shadow-brutal-sm hover:-translate-y-[1px] hover:-translate-x-[1px] flex items-center gap-2",v.value==="dashboard"?"bg-brand-teal text-white shadow-none translate-x-[2px] translate-y-[2px]":"bg-white text-stone-900 hover:shadow-brutal"])},[a(s(we),{class:"w-4 h-4"}),e[15]||(e[15]=c(" Ringkasan ",-1))],2),t("button",{onClick:e[1]||(e[1]=o=>v.value="settings"),class:E(["px-6 py-3 font-display font-bold uppercase tracking-widest text-sm border-2 border-black transition-all shadow-brutal-sm hover:-translate-y-[1px] hover:-translate-x-[1px] flex items-center gap-2",v.value==="settings"?"bg-stone-900 text-white shadow-none translate-x-[2px] translate-y-[2px]":"bg-white text-stone-900 hover:shadow-brutal"])},[a(s(q),{class:"w-4 h-4"}),e[16]||(e[16]=c(" Edit Profil ",-1))],2)]),v.value==="dashboard"?(l(),b("div",qe,[s(K)?(l(),b("div",Qe,[I.value?(l(),f(De,{key:0,text:"Memuat statistik...",class:"py-10"})):(l(),b("div",We,[t("div",Xe,[a(s(H),{class:"bg-white border-2 border-black shadow-brutal"},{default:d(()=>[a(s(N),{class:"p-5 flex flex-col items-center justify-center text-center"},{default:d(()=>[t("div",Ye,[a(s(R),{class:"w-6 h-6 text-stone-900"})]),t("div",Ze,i(h.value.totalFilms),1),e[17]||(e[17]=t("div",{class:"text-[10px] uppercase font-bold text-stone-500 tracking-widest"},"Total Karya",-1))]),_:1})]),_:1}),a(s(H),{class:"bg-white border-2 border-black shadow-brutal"},{default:d(()=>[a(s(N),{class:"p-5 flex flex-col items-center justify-center text-center"},{default:d(()=>[t("div",et,[a(s(X),{class:"w-6 h-6 text-brand-teal"})]),t("div",tt,i(h.value.totalVotes),1),e[18]||(e[18]=t("div",{class:"text-[10px] uppercase font-bold text-stone-500 tracking-widest"},"Total Apresiasi",-1))]),_:1})]),_:1}),a(s(H),{class:"bg-white border-2 border-black shadow-brutal"},{default:d(()=>[a(s(N),{class:"p-5 flex flex-col items-center justify-center text-center"},{default:d(()=>[t("div",st,[a(s(Q),{class:"w-6 h-6 text-brand-orange"})]),t("div",at,i(h.value.totalComments),1),e[19]||(e[19]=t("div",{class:"text-[10px] uppercase font-bold text-stone-500 tracking-widest"},"Total Diskusi",-1))]),_:1})]),_:1})]),t("div",null,[t("div",ot,[e[21]||(e[21]=t("h3",{class:"font-display font-bold text-xl text-stone-900 uppercase tracking-wide"},"Karya Terbaru Saya",-1)),L.value.length>0?(l(),f(s(g),{key:0,variant:"outline",size:"sm",class:"h-8 text-xs font-bold border-2 border-black shadow-brutal hover:shadow-none hover:translate-x-[1px] hover:translate-y-[1px]",onClick:e[2]||(e[2]=o=>s(k).push("/my-archive"))},{default:d(()=>[...e[20]||(e[20]=[c(" Kelola Semua ",-1)])]),_:1})):w("",!0)]),L.value.length===0?(l(),b("div",lt,[a(s(R),{class:"w-12 h-12 mx-auto text-stone-300 mb-3"}),e[23]||(e[23]=t("p",{class:"font-bold text-stone-600 mb-4"},"Belum ada karya yang diupload.",-1)),a(s(g),{size:"sm",onClick:e[3]||(e[3]=o=>s(k).push("/upload")),class:"bg-stone-900 text-white gap-2 border-2 border-black shadow-brutal hover:shadow-none hover:translate-x-[1px] hover:translate-y-[1px]"},{default:d(()=>[a(s(ye),{class:"w-4 h-4"}),e[22]||(e[22]=c(" Upload Karya Pertama ",-1))]),_:1})])):(l(),b("div",rt,[(l(!0),b(ke,null,_e(L.value,o=>(l(),b("div",{key:o.film_id,class:"flex items-center gap-4 p-4 bg-white border-2 border-black shadow-brutal hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-brutal-sm transition-all"},[t("div",nt,[o.gambar_poster?(l(),b("img",{key:0,src:o.gambar_poster,class:"w-full h-full object-cover"},null,8,dt)):(l(),b("div",it,[a(s(R),{class:"w-5 h-5 text-stone-400"})]))]),t("div",ut,[t("h4",bt,i(o.judul),1),t("p",ct,i(o.tahun_karya)+" • "+i(o.category?.nama_kategori),1),a(s(S),{class:E(["text-[10px] px-2 py-0.5 rounded-none border-2 font-bold uppercase",le[o.status]])},{default:d(()=>[c(i(re[o.status]),1)]),_:2},1032,["class"])]),t("div",pt,[a(s(S),{variant:"outline",class:"gap-1 border-stone-300"},{default:d(()=>[a(s(X),{class:"w-3 h-3"}),c(" "+i(o.vote_count),1)]),_:2},1024),a(s(S),{variant:"outline",class:"gap-1 border-stone-300"},{default:d(()=>[a(s(Q),{class:"w-3 h-3"}),c(" "+i(o.comment_count),1)]),_:2},1024)])]))),128))]))])]))])):(l(),b("div",mt,[t("div",xt,[a(s(B),{class:"w-10 h-10 text-stone-900"})]),e[26]||(e[26]=t("h3",{class:"font-display font-bold text-2xl mb-2 text-stone-900 uppercase"},"Halo, penikmat karya!",-1)),e[27]||(e[27]=t("p",{class:"text-stone-600 mb-8 font-medium max-w-sm mx-auto"},"Jelajahi karya-karya siswa di halaman utama atau atur koleksi favoritmu.",-1)),t("div",ft,[a(s(g),{class:"bg-stone-900 text-white border-2 border-black shadow-brutal hover:shadow-none hover:translate-x-[2px] hover:translate-y-[2px] h-12 px-6",onClick:e[4]||(e[4]=o=>s(k).push("/"))},{default:d(()=>[...e[24]||(e[24]=[c(" Cari Karya ",-1)])]),_:1}),a(s(g),{variant:"outline",class:"bg-white text-stone-900 border-2 border-black shadow-brutal hover:shadow-none hover:translate-x-[2px] hover:translate-y-[2px] h-12 px-6",onClick:e[5]||(e[5]=o=>s(k).push("/collections"))},{default:d(()=>[...e[25]||(e[25]=[c(" Lihat Koleksi ",-1)])]),_:1})])]))])):w("",!0),v.value==="settings"?(l(),b("div",vt,[t("div",ht,[e[32]||(e[32]=t("div",{class:"absolute top-0 right-0 w-4 h-4 bg-brand-teal border-l-2 border-b-2 border-black"},null,-1)),t("h3",wt,[a(s(B),{class:"w-5 h-5"}),e[28]||(e[28]=c(" Informasi Dasar ",-1))]),t("div",gt,[t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-bold uppercase tracking-wide text-stone-900 mb-2"},"Nama Tampilan",-1)),a(s(V),{modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=o=>C.value=o),class:"border-2 border-black shadow-brutal-sm focus:shadow-none focus:translate-x-[1px] focus:translate-y-[1px] transition-all h-12 text-lg font-medium"},null,8,["modelValue"])]),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-bold uppercase tracking-wide text-stone-900 mb-2"},"Email",-1)),a(s(V),{value:s(p)?.email,disabled:"",class:"bg-stone-100 border-2 border-stone-300 text-stone-500 h-12 cursor-not-allowed font-mono"},null,8,["value"])]),t("div",yt,[a(s(g),{onClick:ue,disabled:U.value,class:"w-full sm:w-auto bg-stone-900 text-white border-2 border-black shadow-brutal hover:shadow-none hover:translate-x-[2px] hover:translate-y-[2px] h-12 px-8 font-bold uppercase tracking-widest text-xs"},{default:d(()=>[U.value?(l(),f(s(W),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):w("",!0),e[31]||(e[31]=c(" Simpan Profil ",-1))]),_:1},8,["disabled"])])])]),t("div",kt,[e[38]||(e[38]=t("div",{class:"absolute top-0 right-0 w-4 h-4 bg-brand-red border-l-2 border-b-2 border-black"},null,-1)),t("h3",_t,[a(s(q),{class:"w-5 h-5"}),e[33]||(e[33]=c(" Keamanan Akun ",-1))]),t("div",Ct,[t("div",null,[e[34]||(e[34]=t("label",{class:"block text-sm font-bold uppercase tracking-wide text-stone-900 mb-2"},"Password Saat Ini",-1)),t("div",Pt,[a(s(V),{modelValue:D.value,"onUpdate:modelValue":e[7]||(e[7]=o=>D.value=o),type:T.value?"text":"password",class:"border-2 border-black shadow-brutal-sm h-12 pr-12",placeholder:"••••••••"},null,8,["modelValue","type"]),t("button",{type:"button",onClick:e[8]||(e[8]=o=>T.value=!T.value),class:"absolute right-4 top-1/2 -translate-y-1/2 text-stone-400 hover:text-stone-900"},[T.value?(l(),f(s(Pe),{key:1,class:"w-5 h-5"})):(l(),f(s(Ce),{key:0,class:"w-5 h-5"}))])])]),t("div",jt,[t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm font-bold uppercase tracking-wide text-stone-900 mb-2"},"Password Baru",-1)),a(s(V),{modelValue:P.value,"onUpdate:modelValue":e[9]||(e[9]=o=>P.value=o),type:te.value?"text":"password",class:"border-2 border-black shadow-brutal-sm h-12",placeholder:"••••••••"},null,8,["modelValue","type"])]),t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm font-bold uppercase tracking-wide text-stone-900 mb-2"},"Konfirmasi",-1)),a(s(V),{modelValue:F.value,"onUpdate:modelValue":e[10]||(e[10]=o=>F.value=o),type:se.value?"text":"password",class:"border-2 border-black shadow-brutal-sm h-12",placeholder:"••••••••"},null,8,["modelValue","type"])])]),t("div",Vt,[a(s(g),{variant:"outline",onClick:be,disabled:A.value,class:"w-full sm:w-auto bg-white text-stone-900 border-2 border-black shadow-brutal hover:shadow-none hover:translate-x-[2px] hover:translate-y-[2px] h-12 px-8 font-bold uppercase tracking-widest text-xs"},{default:d(()=>[A.value?(l(),f(s(W),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):w("",!0),e[37]||(e[37]=c(" Update Password ",-1))]),_:1},8,["disabled"])])])])])):w("",!0)]),a(Ve,{show:s($).show,type:s($).type,message:s($).message,onClose:e[11]||(e[11]=o=>s($).show=!1)},null,8,["show","type","message"])]),_:1}))}},At=xe($t,[["__scopeId","data-v-6380077a"]]);export{At as default};
