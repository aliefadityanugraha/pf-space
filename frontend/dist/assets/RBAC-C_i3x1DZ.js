import{e as X,f as J,g as i,a as s,h as n,w as r,B as d,a0 as S,k as a,A as B,E as b,r as u,D,aH as I,L as V,C as c,F as _,q as L,aK as Q,aL as O,S as W,l as Y,z as H,n as Z,p as ee,G as M,t as $,o,c as y,U as se,m as te,v as ae,ak as le,X as ne,H as oe}from"./index-Co7LmOIS.js";import{R as re}from"./refresh-cw-NC5O2nye.js";import{U as F}from"./users-CKGDLssN.js";import{S as ie}from"./square-pen-CJ0RyrEx.js";const de=X("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),ce={class:"p-4 md:p-8"},ue={class:"flex items-center gap-2 text-xs font-mono uppercase tracking-wider mb-4"},pe={key:0,class:"flex items-center justify-center py-20"},ge={key:1,class:"bg-red-50 border-2 border-red-300 p-6 text-center"},me={class:"text-red-600 text-sm mb-4"},fe={class:"mb-8"},xe={class:"text-lg font-bold uppercase tracking-wider mb-4 flex items-center gap-2"},ve={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4"},be={class:"flex items-center justify-between mb-3"},_e={class:"text-xs text-stone-500 bg-stone-100 px-2 py-1 border border-stone-300"},ye={class:"text-xs text-stone-600 mb-3"},ke={class:"flex items-center gap-1 text-xs text-stone-500"},he={class:"flex flex-col xl:flex-row xl:items-center xl:justify-between gap-4"},we={class:"flex items-center gap-3"},Ce={class:"flex flex-col sm:flex-row gap-3"},Re={class:"relative"},Ue={class:"lg:col-span-4 flex items-center gap-3"},Be={class:"w-10 h-10 bg-stone-200 border-2 border-stone-800 shadow-brutal-sm flex items-center justify-center text-sm font-bold overflow-hidden"},De=["src","alt"],Le={key:1},$e={class:"font-bold text-sm"},ze={class:"text-xs text-stone-500"},je={class:"lg:col-span-2"},Ae=["value"],Pe={class:"lg:col-span-3"},Se={class:"text-sm text-stone-600"},Ie={class:"lg:col-span-3 flex justify-start lg:justify-end gap-2"},Ve={key:0,class:"px-6 py-12 text-center"},qe={__name:"RBAC",setup(He){const k=u(""),h=u([]),p=u([]),f=u(!0),w=u(null),x=u(null),C=u(null),g=u(null),{showToast:z}=oe(),N={admin:"bg-red-100 text-red-800 border-red-300",moderator:"bg-orange-100 text-orange-800 border-orange-300",creator:"bg-blue-100 text-blue-800 border-blue-300",user:"bg-green-100 text-green-800 border-green-300"};async function R(){f.value=!0,w.value=null;try{const[l,e]=await Promise.all([$.get("/api/auth/roles"),$.get("/api/auth/users")]);h.value=l.data||[],p.value=e.data||[]}catch(l){console.error("Failed to fetch RBAC data:",l),w.value=l.message||"Gagal memuat data"}finally{f.value=!1}}const j=ee(()=>{if(!k.value)return p.value;const l=k.value.toLowerCase();return p.value.filter(e=>e.name?.toLowerCase().includes(l)||e.email?.toLowerCase().includes(l)||e.role?.name?.toLowerCase().includes(l))}),A=l=>N[l]||"bg-stone-100 text-stone-800 border-stone-300",T=l=>p.value.filter(e=>e.role_id===l).length;function q(l){C.value=l.id,g.value=l.role_id}function P(){C.value=null,g.value=null}async function E(l){if(g.value){x.value=l;try{const e=await $.patch(`/api/auth/users/${l}/role`,{role_id:g.value}),v=p.value.findIndex(t=>t.id===l);v!==-1&&e.data&&(p.value[v]=e.data),P();const U=h.value.find(t=>t.role_id===parseInt(g.value))?.name;z(`Peran pengguna diperbarui menjadi ${U||"role baru"}`)}catch(e){console.error("Failed to update role:",e),z(e.message||"Gagal memperbarui peran","error")}finally{x.value=null}}}function G(l){if(!l)return"?";const e=l.split(" ");return e.length>=2?(e[0][0]+e[1][0]).toUpperCase():l.substring(0,2).toUpperCase()}function K(l){return l?new Date(l).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"}):"-"}return J(()=>{R()}),(l,e)=>{const v=S("router-link"),U=S("PageHeader");return o(),i("div",ce,[s("nav",ue,[n(v,{to:"/",class:"text-brand-teal hover:underline"},{default:r(()=>[...e[2]||(e[2]=[d("Beranda",-1)])]),_:1}),e[5]||(e[5]=s("span",{class:"text-stone-400"},"/",-1)),n(v,{to:"/admin",class:"text-stone-600 hover:underline"},{default:r(()=>[...e[3]||(e[3]=[d("Administrasi",-1)])]),_:1}),e[6]||(e[6]=s("span",{class:"text-stone-400"},"/",-1)),n(a(B),{variant:"outline",class:"bg-orange-100 text-orange-700 border-orange-300"},{default:r(()=>[...e[4]||(e[4]=[d(" Kontrol Akses ",-1)])]),_:1})]),n(U,{title:"Pengaturan Hak Akses",description:"Kelola role dan izin pengguna untuk sistem PF Space.",icon:a(I),"icon-color":"bg-amber-500"},{actions:r(()=>[n(a(b),{onClick:R,disabled:f.value,class:"gap-2"},{default:r(()=>[n(a(re),{class:D(["w-4 h-4",f.value&&"animate-spin"])},null,8,["class"]),e[7]||(e[7]=d(" Refresh ",-1))]),_:1},8,["disabled"])]),_:1},8,["icon"]),f.value?(o(),i("div",pe,[n(a(V),{class:"w-8 h-8 animate-spin text-brand-teal"}),e[8]||(e[8]=s("span",{class:"ml-3 text-stone-600"},"Memuat data...",-1))])):w.value?(o(),i("div",ge,[e[10]||(e[10]=s("p",{class:"text-red-800 font-bold mb-2"},"Gagal Memuat Data",-1)),s("p",me,c(w.value),1),n(a(b),{onClick:R,variant:"outline"},{default:r(()=>[...e[9]||(e[9]=[d("Coba Lagi",-1)])]),_:1})])):(o(),i(_,{key:2},[s("section",fe,[s("h2",xe,[n(a(I),{class:"w-5 h-5"}),e[11]||(e[11]=d(" Daftar Role ",-1))]),s("div",ve,[(o(!0),i(_,null,L(h.value,t=>(o(),y(a(M),{key:t.role_id,class:"hover:shadow-brutal transition-shadow"},{default:r(()=>[n(a(H),{class:"p-4"},{default:r(()=>[s("div",be,[n(a(B),{class:D([A(t.name),"font-bold capitalize"]),variant:"outline"},{default:r(()=>[d(c(t.name),1)]),_:2},1032,["class"]),s("span",_e," ID: "+c(t.role_id),1)]),s("p",ye,c(t.description||"Tidak ada deskripsi"),1),s("div",ke,[n(a(F),{class:"w-3 h-3"}),d(" "+c(T(t.role_id))+" pengguna ",1)])]),_:2},1024)]),_:2},1024))),128))])]),n(a(M),null,{default:r(()=>[n(a(Q),{class:"bg-stone-50 border-b-2 border-stone-800"},{default:r(()=>[s("div",he,[s("div",we,[n(a(F),{class:"w-5 h-5"}),n(a(O),{class:"text-lg font-bold uppercase"},{default:r(()=>[d(" Manajemen Pengguna ("+c(p.value.length)+" pengguna) ",1)]),_:1})]),s("div",Ce,[s("div",Re,[n(a(W),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-stone-400"}),n(a(Y),{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=t=>k.value=t),placeholder:"Cari pengguna...",class:"pl-10 w-full sm:w-64"},null,8,["modelValue"])])])])]),_:1}),n(a(H),{class:"p-0"},{default:r(()=>[e[18]||(e[18]=s("div",{class:"hidden lg:grid grid-cols-12 gap-4 px-6 py-3 bg-lime-50 border-b-2 border-stone-800 text-xs font-bold uppercase tracking-wider"},[s("div",{class:"col-span-4"},"Pengguna"),s("div",{class:"col-span-2"},"Role"),s("div",{class:"col-span-3"},"Bergabung"),s("div",{class:"col-span-3 text-right"},"Aksi")],-1)),(o(!0),i(_,null,L(j.value,t=>(o(),i("div",{key:t.id,class:"grid grid-cols-1 lg:grid-cols-12 gap-4 px-6 py-4 items-center border-b border-stone-200 hover:bg-stone-50"},[s("div",Ue,[s("div",Be,[t.image?(o(),i("img",{key:0,src:a(se)(t.image),alt:t.name,class:"w-full h-full object-cover"},null,8,De)):(o(),i("span",Le,c(G(t.name)),1))]),s("div",null,[s("p",$e,c(t.name),1),s("p",ze,c(t.email),1)])]),s("div",je,[e[12]||(e[12]=s("span",{class:"lg:hidden text-xs text-stone-500 uppercase mr-2"},"Role:",-1)),C.value!==t.id?(o(),y(a(B),{key:0,class:D([A(t.role?.name),"font-bold capitalize"]),variant:"outline"},{default:r(()=>[d(c(t.role?.name||"Unknown"),1)]),_:2},1032,["class"])):te((o(),i("select",{key:1,"onUpdate:modelValue":e[1]||(e[1]=m=>g.value=m),class:"text-xs border-2 border-stone-800 px-2 py-1 bg-white focus:outline-none focus:ring-2 focus:ring-brand-teal"},[(o(!0),i(_,null,L(h.value,m=>(o(),i("option",{key:m.role_id,value:m.role_id},c(m.name),9,Ae))),128))],512)),[[ae,g.value]])]),s("div",Pe,[e[13]||(e[13]=s("span",{class:"lg:hidden text-xs text-stone-500 uppercase mr-2"},"Joined:",-1)),s("span",Se,c(K(t.createdAt)),1)]),s("div",Ie,[C.value!==t.id?(o(),y(a(b),{key:0,onClick:m=>q(t),variant:"outline",size:"sm",class:"gap-1 text-xs"},{default:r(()=>[n(a(ie),{class:"w-3 h-3"}),e[14]||(e[14]=d(" Ubah Role ",-1))]),_:1},8,["onClick"])):(o(),i(_,{key:1},[n(a(b),{onClick:m=>E(t.id),disabled:x.value===t.id,size:"sm",class:"gap-1 text-xs bg-green-600 hover:bg-green-700"},{default:r(()=>[x.value===t.id?(o(),y(a(V),{key:0,class:"w-3 h-3 animate-spin"})):(o(),y(a(le),{key:1,class:"w-3 h-3"})),e[15]||(e[15]=d(" Simpan ",-1))]),_:2},1032,["onClick","disabled"]),n(a(b),{onClick:P,disabled:x.value===t.id,variant:"outline",size:"sm",class:"gap-1 text-xs"},{default:r(()=>[n(a(ne),{class:"w-3 h-3"}),e[16]||(e[16]=d(" Batal ",-1))]),_:1},8,["disabled"])],64))])]))),128)),j.value.length===0?(o(),i("div",Ve,[n(a(de),{class:"w-12 h-12 text-stone-300 mx-auto mb-4"}),e[17]||(e[17]=s("p",{class:"text-stone-500"},"Tidak ada pengguna yang cocok dengan pencarianmu.",-1))])):Z("",!0)]),_:1})]),_:1})],64))])}}};export{qe as default};
