import{ab as R,f as q,g as d,a as t,h as a,w as n,B as u,a2 as S,k as s,A as K,a5 as w,z as g,c as V,n as h,S as I,l as Q,r as f,m as J,a0 as M,v as O,F as B,q as T,X,E as _,G as b,L as H,C as r,p as W,aI as Y,aJ as Z,t as L,H as ee,a1 as te,o,V as se,a6 as ae,O as le,a7 as ne,Q as ie}from"./index-Bss2i7k5.js";import{F as oe}from"./funnel-cxvqGzNT.js";import{C as z}from"./calendar-LFuDcZzY.js";const re={class:"p-4 md:p-8"},de={class:"flex items-center gap-2 text-xs font-mono uppercase tracking-wider mb-4"},ue={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ce={class:"relative"},me={class:"relative"},fe=["value"],pe={key:0,class:"flex flex-col items-center justify-center min-h-[400px]"},ve={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},xe={class:"flex items-center justify-between"},ge={class:"text-2xl font-bold text-stone-900"},_e={class:"flex items-center justify-between"},be={class:"text-2xl font-bold text-stone-900"},ke={class:"flex items-center justify-between"},we={class:"text-2xl font-bold text-stone-900"},he={key:0,class:"text-center py-12"},ye={key:1,class:"divide-y divide-stone-200"},Ce={class:"flex gap-4"},$e={class:"w-10 h-10 bg-brand-orange border-2 border-stone-800 shadow-brutal-sm flex items-center justify-center text-sm font-bold shrink-0"},je={class:"flex-1 min-w-0"},Fe={class:"flex items-start justify-between gap-4 mb-2"},Pe={class:"flex-1 min-w-0"},Ve={class:"flex items-center gap-2 flex-wrap mb-1"},Be={class:"font-bold text-stone-900"},Le={class:"flex items-center gap-3 text-xs text-stone-500"},Se={class:"flex items-center gap-1"},Ke={key:0,class:"flex items-center gap-1"},Me={class:"flex items-center gap-2"},Te={class:"mt-3 p-4 bg-stone-100 border-l-4 border-brand-teal"},He={class:"text-sm text-stone-700 whitespace-pre-wrap leading-relaxed"},ze={key:0,class:"mt-2 text-xs text-stone-500 flex items-center gap-1"},Ne={key:0,class:"flex items-center justify-between mt-6"},Ae={class:"text-sm text-stone-600"},De={class:"flex gap-2"},qe={__name:"Comments",setup(Ue){const N=te(),y=f(!0),k=f(null),C=f([]),$=f([]),c=f({page:1,limit:20,total:0,totalPages:0}),v=f(""),p=f(""),m=f(1),{showToast:j}=ee(),A=async()=>{try{const i=await L.get("/api/films",{params:{limit:1e3,status:"published"}});$.value=i.data||[]}catch(i){console.error("Failed to fetch films:",i)}},F=async()=>{y.value=!0;try{const i={page:m.value,limit:c.value.limit};p.value&&(i.film_id=p.value);const e=await L.get("/api/discussions/all",{params:i});e.success&&(C.value=e.data||[],c.value=e.pagination||c.value)}catch(i){console.error("Failed to fetch comments:",i),j("Gagal memuat komentar","error")}finally{y.value=!1}},D=async i=>{if(confirm("Hapus komentar ini? Semua balasan juga akan terhapus.")){k.value=i;try{await L.delete(`/api/discussions/${i}`),j("Komentar berhasil dihapus"),await F()}catch(e){console.error("Failed to delete comment:",e),j("Gagal menghapus komentar","error")}finally{k.value=null}}},P=W(()=>{if(!v.value.trim())return C.value;const i=v.value.toLowerCase();return C.value.filter(e=>e.isi_pesan?.toLowerCase().includes(i)||e.user?.name?.toLowerCase().includes(i)||e.film?.judul?.toLowerCase().includes(i))});R([p,m],()=>{F()},{immediate:!1});const U=i=>$.value.find(x=>x.film_id===i)?.judul||"Arsip tidak dikenal";return q(async()=>{await Promise.all([A(),F()])}),(i,e)=>{const x=S("router-link"),E=S("PageHeader");return o(),d("div",re,[t("nav",de,[a(x,{to:"/",class:"text-brand-teal hover:underline"},{default:n(()=>[...e[5]||(e[5]=[u("Beranda",-1)])]),_:1}),e[8]||(e[8]=t("span",{class:"text-stone-400"},"/",-1)),a(x,{to:"/admin",class:"text-stone-600 hover:underline"},{default:n(()=>[...e[6]||(e[6]=[u("Administrasi",-1)])]),_:1}),e[9]||(e[9]=t("span",{class:"text-stone-400"},"/",-1)),a(s(K),{variant:"outline",class:"bg-orange-100 text-orange-700 border-orange-300"},{default:n(()=>[...e[7]||(e[7]=[u("Komentar",-1)])]),_:1})]),a(E,{title:"Kelola Komentar",description:"Moderasi dan kelola semua komentar pengguna di platform.",icon:s(w),"icon-color":"bg-teal-500"},null,8,["icon"]),a(s(b),{class:"mb-6"},{default:n(()=>[a(s(g),{class:"p-4"},{default:n(()=>[t("div",ue,[t("div",ce,[a(s(I),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-stone-400"}),a(s(Q),{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),placeholder:"Cari komentar...",class:"pl-10"},null,8,["modelValue"])]),t("div",me,[a(s(M),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-stone-400"}),J(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>p.value=l),class:"w-full pl-10 pr-4 py-2 border-2 border-stone-800 bg-white focus:outline-none focus:ring-0 font-body"},[e[10]||(e[10]=t("option",{value:""},"Semua Karya",-1)),(o(!0),d(B,null,T($.value,l=>(o(),d("option",{key:l.film_id,value:l.film_id},r(l.judul),9,fe))),128))],512),[[O,p.value]])]),p.value||v.value?(o(),V(s(_),{key:0,variant:"outline",onClick:e[2]||(e[2]=l=>{p.value="",v.value=""}),class:"gap-2"},{default:n(()=>[a(s(X),{class:"w-4 h-4"}),e[11]||(e[11]=u(" Reset Filter ",-1))]),_:1})):h("",!0)])]),_:1})]),_:1}),y.value?(o(),d("div",pe,[a(s(H),{class:"w-12 h-12 animate-spin text-brand-teal mb-4"}),e[12]||(e[12]=t("p",{class:"text-stone-500 font-mono uppercase tracking-widest animate-pulse"},"Memuat komentar...",-1))])):(o(),d(B,{key:1},[t("div",ve,[a(s(b),null,{default:n(()=>[a(s(g),{class:"p-4"},{default:n(()=>[t("div",xe,[t("div",null,[e[13]||(e[13]=t("p",{class:"text-xs font-bold uppercase tracking-wider text-stone-600 mb-1"},"Total Komentar",-1)),t("p",ge,r(c.value.total),1)]),a(s(w),{class:"w-8 h-8 text-brand-teal"})])]),_:1})]),_:1}),a(s(b),null,{default:n(()=>[a(s(g),{class:"p-4"},{default:n(()=>[t("div",_e,[t("div",null,[e[14]||(e[14]=t("p",{class:"text-xs font-bold uppercase tracking-wider text-stone-600 mb-1"},"Ditampilkan",-1)),t("p",be,r(P.value.length),1)]),a(s(oe),{class:"w-8 h-8 text-brand-orange"})])]),_:1})]),_:1}),a(s(b),null,{default:n(()=>[a(s(g),{class:"p-4"},{default:n(()=>[t("div",ke,[t("div",null,[e[15]||(e[15]=t("p",{class:"text-xs font-bold uppercase tracking-wider text-stone-600 mb-1"},"Halaman",-1)),t("p",we,r(m.value)+" / "+r(c.value.totalPages),1)]),a(s(z),{class:"w-8 h-8 text-brand-red"})])]),_:1})]),_:1})]),a(s(b),null,{default:n(()=>[a(s(Y),{class:"bg-brand-teal/10 border-b-2 border-stone-800"},{default:n(()=>[a(s(Z),{class:"flex items-center gap-2"},{default:n(()=>[a(s(w),{class:"w-5 h-5"}),e[16]||(e[16]=u(" Semua Komentar ",-1))]),_:1})]),_:1}),a(s(g),{class:"p-0"},{default:n(()=>[P.value.length===0?(o(),d("div",he,[a(s(w),{class:"w-16 h-16 text-stone-300 mx-auto mb-4"}),e[17]||(e[17]=t("h3",{class:"text-lg font-bold text-stone-700 mb-1"},"Belum ada komentar yang ditampilkan",-1)),e[18]||(e[18]=t("p",{class:"text-stone-500 font-body mb-1"}," Tidak ada komentar yang cocok dengan filter saat ini. ",-1)),e[19]||(e[19]=t("p",{class:"text-sm text-stone-400"}," Coba reset filter, ubah kata kunci pencarian, atau periksa periode waktu yang berbeda. ",-1))])):(o(),d("div",ye,[(o(!0),d(B,null,T(P.value,l=>(o(),d("div",{key:l.diskusi_id,class:"p-6 hover:bg-stone-50 transition-colors"},[t("div",Ce,[t("div",$e,r(l.user?.name?.charAt(0)||"U"),1),t("div",je,[t("div",Fe,[t("div",Pe,[t("div",Ve,[t("span",Be,r(l.user?.name||"Pengguna tidak dikenal"),1),a(s(K),{variant:"outline",class:"text-xs"},{default:n(()=>[a(s(se),{class:"w-3 h-3 mr-1"}),u(" "+r(l.user?.email||"Tidak ada email"),1)]),_:2},1024)]),t("div",Le,[t("span",Se,[a(s(z),{class:"w-3 h-3"}),u(" "+r(s(ae)(l.created_at,!0)),1)]),l.film?(o(),d("span",Ke,[a(s(M),{class:"w-3 h-3"}),a(x,{to:`/archive/${l.film?.slug}`,class:"hover:text-brand-teal hover:underline"},{default:n(()=>[u(r(l.film?.judul||U(l.film_id)),1)]),_:2},1032,["to"])])):h("",!0)])]),t("div",Me,[a(s(_),{variant:"outline",size:"sm",onClick:G=>s(N).push(`/archive/${l.film?.slug}`),class:"gap-1"},{default:n(()=>[a(s(le),{class:"w-3 h-3"}),e[20]||(e[20]=u(" Lihat ",-1))]),_:1},8,["onClick"]),a(s(_),{variant:"destructive",size:"sm",onClick:G=>D(l.diskusi_id),disabled:k.value===l.diskusi_id,class:"gap-1"},{default:n(()=>[k.value===l.diskusi_id?(o(),V(s(H),{key:0,class:"w-3 h-3 animate-spin"})):(o(),V(s(ne),{key:1,class:"w-3 h-3"})),e[21]||(e[21]=u(" Hapus ",-1))]),_:2},1032,["onClick","disabled"])])]),t("div",Te,[t("p",He,r(l.isi_pesan),1)]),l.parent_id?(o(),d("div",ze,[a(s(ie),{class:"w-3 h-3"}),e[22]||(e[22]=t("span",null,"Ini adalah balasan dari komentar lain",-1))])):h("",!0)])])]))),128))]))]),_:1})]),_:1}),c.value.totalPages>1?(o(),d("div",Ne,[t("div",Ae," Menampilkan "+r((m.value-1)*c.value.limit+1)+" sampai "+r(Math.min(m.value*c.value.limit,c.value.total))+" dari "+r(c.value.total)+" komentar ",1),t("div",De,[a(s(_),{variant:"outline",size:"sm",onClick:e[3]||(e[3]=l=>m.value--),disabled:m.value===1},{default:n(()=>[...e[23]||(e[23]=[u(" Sebelumnya ",-1)])]),_:1},8,["disabled"]),a(s(_),{variant:"outline",size:"sm",onClick:e[4]||(e[4]=l=>m.value++),disabled:m.value>=c.value.totalPages},{default:n(()=>[...e[24]||(e[24]=[u(" Berikutnya ",-1)])]),_:1},8,["disabled"])])])):h("",!0)],64))])}}};export{qe as default};
