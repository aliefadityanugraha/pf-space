import{f as se,g as r,h as a,a as s,n as F,r as u,w as n,B as m,U as te,k as t,A as K,E as f,Y as A,z as J,G as L,C as d,ag as O,aj as ae,l as le,aI as ie,c as _,L as V,ah as oe,aA as ne,aB as re,F as P,q,D as I,ac as ue,$ as M,t as x,H as de,o,a2 as ce,au as me,O as ve,V as fe,aJ as pe}from"./index-CAAauX25.js";import{A as be}from"./SidebarAdmin-Ce2jwnp-.js";import{_ as ke}from"./PageHeader-B81AyTQ4.js";import{P as _e}from"./plus-B4G0bIPy.js";import{S as xe}from"./square-pen-BL-J5d2J.js";import"./shield-Dh_uULPf.js";import"./file-text-IDAJaDof.js";import"./settings-D1CiAgJP.js";const ge={class:"min-h-screen bg-stone-100"},he={class:"flex items-center gap-2 text-xs font-mono uppercase tracking-wider mb-4"},ye={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},we={class:"relative bg-white border-2 border-black shadow-brutal w-full max-w-2xl mx-4"},Ce={class:"flex items-center justify-between px-6 py-4 border-b-2 border-black bg-stone-100"},De={class:"font-bold text-lg"},$e={class:"flex gap-3 pt-4"},Be={class:"flex items-center gap-3"},je={key:0,class:"flex items-center justify-center py-12"},Fe={key:1,class:"text-center py-12 text-stone-400"},Ae={class:"flex items-start justify-between gap-4"},Ve={class:"flex-1"},ze={class:"flex items-center gap-3 mb-2"},Te={class:"text-lg font-bold text-stone-900"},Ue={key:0,class:"text-stone-600 text-sm mb-3"},Ee={class:"flex items-center gap-4 text-xs text-stone-500"},Ge=["onClick"],He={class:"flex gap-2"},Me={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Ne={class:"relative bg-white border-2 border-black shadow-brutal w-full max-w-sm mx-4"},Se={class:"flex items-center gap-3 px-6 py-4 border-b-2 border-black bg-red-50"},Re={class:"font-bold text-lg text-red-800"},Ke={class:"p-6"},Je={class:"text-stone-600 mb-6"},Le={class:"flex gap-3"},Oe={key:1,class:"fixed inset-0 z-50 flex items-center justify-center"},Pe={class:"relative bg-white border-2 border-black shadow-brutal w-full max-w-3xl mx-4 max-h-[80vh] flex flex-col"},qe={class:"flex items-center justify-between px-6 py-4 border-b-2 border-black bg-stone-100"},Ie={class:"text-sm text-stone-600 mt-1"},Xe={class:"flex-1 overflow-y-auto p-6"},Ye={key:0,class:"flex items-center justify-center py-12"},Qe={key:1,class:"text-center py-12 text-stone-400"},We={key:2,class:"space-y-4"},Ze={class:"w-10 h-10 bg-brand-teal border-2 border-black shadow-brutal-sm flex items-center justify-center flex-shrink-0 overflow-hidden"},es=["src","alt"],ss={class:"flex-1 min-w-0"},ts={class:"flex items-center justify-between gap-2 mb-2"},as={class:"flex items-center gap-2 text-sm"},ls={class:"font-bold text-stone-900"},is={class:"text-stone-500 text-xs"},os={class:"text-stone-700 text-sm whitespace-pre-wrap break-words"},ns={class:"border-t-2 border-black p-4 bg-stone-50"},ks={__name:"CommunityDiscussions",setup(rs){const N=u(!1),w=u([]),z=u(!0),T=u(!1),b=u(null),C=u(!1),h=u(!1),U=u(!1),D=u(null),k=u([]),E=u(!1),v=u({title:"",description:""}),{showToast:c}=de(),y=u(!1),G=u({title:"",message:"",onConfirm:null}),$=u(null),B=async()=>{z.value=!0;try{const i=await x.get("/api/community");w.value=i.data||[]}catch(i){console.error("Failed to fetch discussions:",i),c("Gagal memuat diskusi","error")}finally{z.value=!1}},S=(i=null)=>{i?(b.value=i.discussion_id,v.value={title:i.title,description:i.description||""}):(b.value=null,v.value={title:"",description:""}),T.value=!0},j=()=>{T.value=!1,b.value=null,v.value={title:"",description:""}},X=async()=>{if(!v.value.title.trim()){c("Judul diskusi harus diisi","error");return}C.value=!0;try{b.value?(await x.put(`/api/community/${b.value}`,v.value),c("Diskusi berhasil diperbarui")):(await x.post("/api/community",v.value),c("Diskusi berhasil dibuat")),await B(),j()}catch(i){console.error("Failed to save discussion:",i),c("Gagal menyimpan diskusi","error")}finally{C.value=!1}},Y=async(i,e)=>{try{await x.patch(`/api/community/${i}/toggle`,{is_active:!e}),c(`Diskusi berhasil ${e?"dinonaktifkan":"diaktifkan"}`),await B()}catch(p){console.error("Failed to toggle discussion:",p),c("Gagal mengubah status diskusi","error")}},Q=i=>{$.value=i,G.value={title:"Hapus Diskusi",message:`Apakah Anda yakin ingin menghapus diskusi "${i.title}"? Semua balasan akan ikut terhapus.`},y.value=!0},W=async()=>{if($.value){h.value=!0;try{await x.delete(`/api/community/${$.value.discussion_id}`),c("Diskusi berhasil dihapus"),await B()}catch(i){console.error("Failed to delete discussion:",i),c("Gagal menghapus diskusi","error")}finally{h.value=!1,y.value=!1,$.value=null}}},R=i=>{try{return pe(i)}catch{return"baru saja"}},Z=async i=>{D.value=i,U.value=!0,E.value=!0;try{const e=await x.get(`/api/community/${i.discussion_id}/replies`);k.value=e.data||[]}catch(e){console.error("Failed to fetch replies:",e),c("Gagal memuat balasan","error"),k.value=[]}finally{E.value=!1}},H=()=>{U.value=!1,D.value=null,k.value=[]},ee=async i=>{if(confirm("Hapus balasan ini?"))try{await x.delete(`/api/community/replies/${i}/moderate`),c("Balasan berhasil dihapus"),k.value=k.value.filter(p=>p.reply_id!==i);const e=w.value.find(p=>p.discussion_id===D.value.discussion_id);e&&(e.reply_count=Math.max(0,(e.reply_count||0)-1))}catch(e){console.error("Failed to delete reply:",e),c("Gagal menghapus balasan","error")}};return se(()=>{B()}),(i,e)=>{const p=te("router-link");return o(),r("div",ge,[a(be,{"onUpdate:collapsed":e[0]||(e[0]=l=>N.value=l)}),s("main",{class:I(["p-4 md:p-8 transition-all duration-300",N.value?"ml-14":"ml-56"])},[s("nav",he,[a(p,{to:"/",class:"text-brand-teal hover:underline"},{default:n(()=>[...e[7]||(e[7]=[m("Beranda",-1)])]),_:1}),e[10]||(e[10]=s("span",{class:"text-stone-400"},"/",-1)),a(p,{to:"/admin",class:"text-stone-600 hover:underline"},{default:n(()=>[...e[8]||(e[8]=[m("Administrasi",-1)])]),_:1}),e[11]||(e[11]=s("span",{class:"text-stone-400"},"/",-1)),a(t(K),{variant:"outline",class:"bg-orange-100 text-orange-700 border-orange-300"},{default:n(()=>[...e[9]||(e[9]=[m("Komunitas",-1)])]),_:1})]),a(ke,{title:"Diskusi Komunitas",description:"Kelola topik diskusi umum untuk komunitas",icon:t(A),"icon-color":"bg-teal-500"},{actions:n(()=>[a(t(f),{onClick:e[1]||(e[1]=l=>S()),class:"gap-2"},{default:n(()=>[a(t(_e),{class:"w-4 h-4"}),e[12]||(e[12]=m(" Buat Diskusi Baru ",-1))]),_:1})]),_:1},8,["icon"]),a(t(L),{class:"mb-6 border-2 border-blue-300 bg-blue-50"},{default:n(()=>[a(t(J),{class:"p-4"},{default:n(()=>[...e[13]||(e[13]=[s("p",{class:"text-sm text-blue-900"},[s("strong",null,"Catatan:"),m(" Hanya satu diskusi yang bisa aktif dalam satu waktu. Diskusi aktif akan ditampilkan di halaman utama dan semua user bisa memberikan balasan. ")],-1)])]),_:1})]),_:1}),T.value?(o(),r("div",ye,[s("div",{class:"absolute inset-0 bg-black/50",onClick:j}),s("div",we,[s("div",Ce,[s("h2",De,d(b.value?"Edit Diskusi":"Buat Diskusi Baru"),1),s("button",{onClick:j,class:"p-1 hover:bg-stone-200"},[a(t(O),{class:"w-5 h-5"})])]),s("form",{onSubmit:ae(X,["prevent"]),class:"p-6 space-y-4"},[s("div",null,[e[14]||(e[14]=s("label",{class:"block text-sm font-bold mb-2"},"Judul Diskusi *",-1)),a(t(le),{modelValue:v.value.title,"onUpdate:modelValue":e[2]||(e[2]=l=>v.value.title=l),placeholder:"Contoh: Apa Karya favorit kalian tahun ini?"},null,8,["modelValue"])]),s("div",null,[e[15]||(e[15]=s("label",{class:"block text-sm font-bold mb-2"},"Deskripsi (Opsional)",-1)),a(t(ie),{modelValue:v.value.description,"onUpdate:modelValue":e[3]||(e[3]=l=>v.value.description=l),placeholder:"Tambahkan konteks atau pertanyaan lebih detail...",class:"min-h-[100px] resize-none"},null,8,["modelValue"])]),s("div",$e,[a(t(f),{type:"button",variant:"outline",class:"flex-1",onClick:j},{default:n(()=>[...e[16]||(e[16]=[m("Batal",-1)])]),_:1}),a(t(f),{type:"submit",class:"flex-1 gap-2",disabled:C.value},{default:n(()=>[C.value?(o(),_(t(V),{key:0,class:"w-4 h-4 animate-spin"})):(o(),_(t(oe),{key:1,class:"w-4 h-4"})),m(" "+d(b.value?"Update":"Buat")+" Diskusi ",1)]),_:1},8,["disabled"])])],32)])])):F("",!0),a(t(L),null,{default:n(()=>[a(t(ne),{class:"bg-teal-50 border-b-2 border-stone-800"},{default:n(()=>[s("div",Be,[a(t(A),{class:"w-5 h-5"}),a(t(re),{class:"text-lg font-bold uppercase"},{default:n(()=>[...e[17]||(e[17]=[m("Daftar Diskusi",-1)])]),_:1})])]),_:1}),a(t(J),{class:"p-0"},{default:n(()=>[z.value?(o(),r("div",je,[a(t(V),{class:"w-8 h-8 animate-spin text-stone-400"})])):w.value.length===0?(o(),r("div",Fe,[a(t(A),{class:"w-12 h-12 mx-auto mb-2 opacity-50"}),e[18]||(e[18]=s("p",null,"Belum ada diskusi komunitas",-1))])):(o(!0),r(P,{key:2},q(w.value,l=>(o(),r("div",{key:l.discussion_id,class:"px-6 py-4 border-b border-stone-200 hover:bg-stone-50"},[s("div",Ae,[s("div",Ve,[s("div",ze,[s("h3",Te,d(l.title),1),a(t(K),{variant:l.is_active?"default":"secondary",class:I(l.is_active?"bg-green-100 text-green-700":"")},{default:n(()=>[m(d(l.is_active?"Aktif":"Nonaktif"),1)]),_:2},1032,["variant","class"])]),l.description?(o(),r("p",Ue,d(l.description),1)):F("",!0),s("div",Ee,[s("span",null,"Dibuat oleh "+d(l.creator?.name),1),e[19]||(e[19]=s("span",null,"•",-1)),s("span",null,d(R(l.created_at)),1),e[20]||(e[20]=s("span",null,"•",-1)),s("button",{onClick:g=>Z(l),class:"text-brand-teal hover:underline font-medium"},d(l.reply_count||0)+" balasan ",9,Ge)])]),s("div",He,[a(t(f),{onClick:g=>Y(l.discussion_id,l.is_active),size:"sm",variant:"outline",title:l.is_active?"Nonaktifkan":"Aktifkan"},{default:n(()=>[l.is_active?(o(),_(t(me),{key:1,class:"w-4 h-4"})):(o(),_(t(ce),{key:0,class:"w-4 h-4"}))]),_:2},1032,["onClick","title"]),a(t(f),{onClick:g=>S(l),size:"sm",variant:"outline",title:"Edit"},{default:n(()=>[a(t(xe),{class:"w-4 h-4"})]),_:1},8,["onClick"]),a(t(f),{onClick:g=>Q(l),size:"sm",variant:"outline",class:"text-red-600 hover:bg-red-50",title:"Hapus"},{default:n(()=>[a(t(M),{class:"w-4 h-4"})]),_:1},8,["onClick"])])])]))),128))]),_:1})]),_:1})],2),y.value?(o(),r("div",Me,[s("div",{class:"absolute inset-0 bg-black/50",onClick:e[4]||(e[4]=l=>y.value=!1)}),s("div",Ne,[s("div",Se,[a(t(ue),{class:"w-5 h-5 text-red-600"}),s("h2",Re,d(G.value.title),1)]),s("div",Ke,[s("p",Je,d(G.value.message),1),s("div",Le,[a(t(f),{type:"button",variant:"outline",class:"flex-1",onClick:e[5]||(e[5]=l=>y.value=!1),disabled:h.value},{default:n(()=>[...e[21]||(e[21]=[m(" Batal ",-1)])]),_:1},8,["disabled"]),a(t(f),{type:"button",class:"flex-1 gap-2 bg-red-600 hover:bg-red-700",onClick:W,disabled:h.value},{default:n(()=>[h.value?(o(),_(t(V),{key:0,class:"w-4 h-4 animate-spin"})):(o(),_(t(M),{key:1,class:"w-4 h-4"})),e[22]||(e[22]=m(" Hapus ",-1))]),_:1},8,["disabled"])])])])])):F("",!0),U.value?(o(),r("div",Oe,[s("div",{class:"absolute inset-0 bg-black/50",onClick:H}),s("div",Pe,[s("div",qe,[s("div",null,[e[23]||(e[23]=s("h2",{class:"font-bold text-lg"},"Balasan Diskusi",-1)),s("p",Ie,d(D.value?.title),1)]),s("button",{onClick:H,class:"p-1 hover:bg-stone-200"},[a(t(O),{class:"w-5 h-5"})])]),s("div",Xe,[E.value?(o(),r("div",Ye,[a(t(V),{class:"w-8 h-8 animate-spin text-stone-400"})])):k.value.length===0?(o(),r("div",Qe,[a(t(A),{class:"w-12 h-12 mx-auto mb-2 opacity-50"}),e[24]||(e[24]=s("p",null,"Belum ada balasan",-1))])):(o(),r("div",We,[(o(!0),r(P,null,q(k.value,l=>(o(),r("div",{key:l.reply_id,class:"flex gap-3 p-4 bg-stone-50 border-2 border-stone-200 hover:border-stone-300 transition-colors"},[s("div",Ze,[l.user?.image?(o(),r("img",{key:0,src:t(ve)(l.user.image),alt:l.user.name,class:"w-full h-full object-cover",onError:e[6]||(e[6]=g=>g.target.style.display="none")},null,40,es)):(o(),_(t(fe),{key:1,class:"w-5 h-5 text-white"}))]),s("div",ss,[s("div",ts,[s("div",as,[s("span",ls,d(l.user?.name||"User"),1),e[25]||(e[25]=s("span",{class:"text-stone-400"},"•",-1)),s("span",is,d(R(l.created_at)),1)]),a(t(f),{onClick:g=>ee(l.reply_id),size:"sm",variant:"outline",class:"text-red-600 hover:bg-red-50",title:"Hapus balasan"},{default:n(()=>[a(t(M),{class:"w-4 h-4"})]),_:1},8,["onClick"])]),s("p",os,d(l.content),1)])]))),128))]))]),s("div",ns,[a(t(f),{onClick:H,variant:"outline",class:"w-full"},{default:n(()=>[...e[26]||(e[26]=[m(" Tutup ",-1)])]),_:1})])])])):F("",!0)])}}};export{ks as default};
