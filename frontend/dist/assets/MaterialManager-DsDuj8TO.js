import{J as te,u as ae,f as se,c as m,w as d,a as e,g as n,n as $,h as o,k as l,ay as N,B as p,E as x,ac as H,aA as le,aB as ie,z as oe,r as u,L as B,F as I,q as re,G as ne,C as f,a8 as K,aj as de,l as L,m as R,K as ue,D as C,aE as ce,ah as pe,as as be,ar as ve,$ as Y,t as F,H as fe,aK as me,o as r,A as O}from"./index-C2TftA0i.js";import{_ as xe}from"./PageLayout-9L3r6HXJ.js";import{U as ge}from"./index-BpHRcGa7.js";import{P as ke}from"./plus-D1rkKHoJ.js";import{S as he}from"./save-tp2dV3x_.js";import{F as _e}from"./file-text-DOlpqagG.js";import{Y as ye}from"./youtube-CBNGKMgv.js";import{P as we}from"./pencil-GpjueBdO.js";const Me={class:"w-full max-w-7xl mx-auto px-4 md:px-8"},je={class:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-10"},$e={class:"flex items-center gap-4"},Ce={class:"p-3 bg-brand-red border-2 border-black shadow-brutal-sm"},Fe={class:"mb-8 p-4 bg-stone-50 border-2 border-black shadow-brutal-sm flex gap-3"},Pe={class:"mt-1 shrink-0"},De={key:0,class:"flex flex-col items-center justify-center py-12"},Te={key:1,class:"text-center py-12 text-stone-400"},Ve={key:2,class:"w-full text-left border-collapse min-w-[800px]"},Se={class:"divide-y divide-stone-200 bg-white"},Ae={class:"px-6 py-4"},Be={class:"font-bold text-stone-900 leading-tight"},Ue={class:"text-xs text-stone-500 line-clamp-1 mt-1"},ze={class:"px-6 py-4"},Ge={class:"px-6 py-4"},Ee={class:"flex items-center gap-2"},Ne={class:"w-6 h-6 rounded-full bg-stone-200 border border-black overflow-hidden flex-shrink-0"},He=["src"],Ie={class:"text-xs"},Ke={class:"px-6 py-4"},Le=["onClick","disabled"],Re={class:"px-6 py-4 text-right"},Ye={class:"flex gap-2 justify-end"},Oe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Je={class:"relative bg-white border-2 border-black shadow-brutal w-full max-w-lg overflow-hidden animate-in zoom-in-95 duration-200"},We={class:"flex items-center justify-between px-6 py-4 border-b-2 border-black bg-stone-100"},qe={class:"font-bold text-lg font-display uppercase tracking-tight"},Xe={key:0,class:"p-3 bg-red-50 border-2 border-red-200 text-red-600 text-sm font-medium"},Qe={class:"space-y-4"},Ze={class:"grid grid-cols-2 gap-4"},et={class:"flex border-2 border-black"},tt={class:"flex items-end pb-1"},at={class:"flex items-center gap-2 cursor-pointer select-none"},st={key:0,class:"space-y-2"},lt={key:0,class:"p-3 bg-green-50 border-2 border-green-200 text-green-700 text-xs flex items-center justify-between"},it={class:"flex items-center gap-2 truncate"},ot={class:"truncate"},rt={key:1},nt={class:"relative"},dt=["disabled"],ut={class:"border-2 border-dashed border-stone-300 p-6 text-center hover:bg-stone-50 transition-colors"},ct={key:0,class:"space-y-2"},pt={class:"flex justify-between text-[10px] font-bold"},bt={class:"w-full h-2 bg-stone-100 border border-black relative"},vt={key:1},ft={class:"flex gap-3 pt-4"},mt={key:1,class:"fixed inset-0 z-[60] flex items-center justify-center p-4"},xt={class:"relative bg-white border-2 border-black shadow-brutal w-full max-w-sm p-6 overflow-hidden animate-in fade-in duration-200"},gt={class:"flex items-center gap-3 text-red-600 mb-4"},kt={class:"text-sm text-stone-600 mb-6 font-medium"},ht={class:"text-black font-bold"},_t={class:"flex gap-3"},yt={__name:"MaterialManager",setup(wt){ae({title:"Kelola Materi - PF Space"});const U=u([]),z=u(!0),_=u(!1),P=u(!1),g=u(!1),y=u(0),G=u(!1),w=u(null),i=u({judul:"",deskripsi:"",tipe:"pdf",file_path:"",video_url:"",is_active:!0}),b=u(""),{showToast:c}=fe(),D=async()=>{z.value=!0;try{const a={owner:"true"},t=await F.get("/api/learning-materials",{params:a});U.value=t.data}catch(a){console.error("Failed to fetch materials:",a),c("Gagal memuat materi","error")}finally{z.value=!1}},J=(a,t)=>new Promise((s,h)=>{const ee=`${me}/api/files/`,S=new ge(a,{endpoint:ee,retryDelays:[0,3e3,5e3,1e4,2e4],metadata:{filename:a.name,filetype:a.type||"application/octet-stream"},storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!0,onError:v=>{h(v)},onProgress:(v,A)=>{const j=(v/A*100).toFixed(0);t&&t(+j)},onSuccess:()=>{try{const v=S.url.split("/api/files/")[1];if(v&&v.includes("/"))s(`/uploads/${v}`);else if(v){const A=a.type||"";let j="documents";A.startsWith("video/")?j="videos":A.startsWith("image/")&&(j="images"),s(`/uploads/${j}/${v}`)}else s(S.url)}catch{s(S.url)}}});S.start()}),W=async a=>{const t=a.target.files[0];if(t){if(t.type!=="application/pdf"){c("Hanya file PDF yang diizinkan","error"),a.target.value="";return}if(t.size>20*1024*1024){c("Ukuran file maksimal 20MB","error"),a.target.value="";return}g.value=!0,y.value=0;try{const s=await J(t,h=>{y.value=h});i.value.file_path=s,c("File berhasil diupload")}catch(s){console.error("Upload failed:",s),c("Gagal mengupload file","error")}finally{g.value=!1}}},E=(a=null)=>{w.value=a,a?i.value={judul:a.judul,deskripsi:a.deskripsi||"",tipe:a.tipe,file_path:a.file_path||"",video_url:a.video_url||"",is_active:a.is_active}:i.value={judul:"",deskripsi:"",tipe:"pdf",file_path:"",video_url:"",is_active:!0},b.value="",G.value=!0,y.value=0},T=()=>{g.value||(G.value=!1,w.value=null)},q=async()=>{if(b.value="",!i.value.judul.trim()){b.value="Judul materi wajib diisi";return}if(i.value.tipe==="pdf"&&!i.value.file_path){b.value="Anda harus mengunggah file PDF terlebih dahulu";return}if(i.value.tipe==="video"){if(!i.value.video_url.trim()){b.value="URL Video YouTube wajib diisi";return}if(!/^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+$/.test(i.value.video_url)){b.value="Mohon masukkan alamat URL YouTube yang valid";return}}_.value=!0;try{const a={judul:i.value.judul,deskripsi:i.value.deskripsi,tipe:i.value.tipe,is_active:i.value.is_active,file_path:i.value.tipe==="pdf"?i.value.file_path:null,video_url:i.value.tipe==="video"?i.value.video_url:null};w.value?(await F.put(`/api/learning-materials/${w.value.materi_id}`,a),c("Materi berhasil diperbarui")):(await F.post("/api/learning-materials",a),c("Materi berhasil ditambahkan")),T(),await D()}catch(a){a.data&&Array.isArray(a.data.details)?b.value=a.data.details[0].message:b.value=a.message||"Gagal menyimpan materi"}finally{_.value=!1}},M=u(null),V=u(!1),X=a=>{M.value=a,V.value=!0},Q=async()=>{if(M.value){P.value=!0;try{await F.delete(`/api/learning-materials/${M.value.materi_id}`),c("Materi berhasil dihapus"),await D()}catch{c("Gagal menghapus materi","error")}finally{P.value=!1,V.value=!1,M.value=null}}},k=u(new Set),Z=async a=>{if(!k.value.has(a.materi_id)){k.value.add(a.materi_id);try{await F.patch(`/api/learning-materials/${a.materi_id}/toggle`),c("Status materi diperbarui"),await D()}catch{c("Gagal merubah status","error")}finally{k.value.delete(a.materi_id)}}};return se(D),(a,t)=>(r(),m(xe,null,{default:d(()=>[e("div",Me,[e("div",je,[e("div",$e,[e("div",Ce,[o(l(N),{class:"w-6 h-6 text-white"})]),t[9]||(t[9]=e("div",null,[e("h1",{class:"text-3xl md:text-4xl font-display font-bold text-stone-900 leading-none"},"Kelola Materi"),e("p",{class:"text-stone-500 mt-2"},"Kelola materi pembelajaran untuk publik (PDF & Video).")],-1))]),o(l(x),{onClick:t[0]||(t[0]=s=>E()),class:"gap-2 border-2 border-black shadow-brutal hover:shadow-none hover:translate-x-1 hover:translate-y-1 transition-all"},{default:d(()=>[o(l(ke),{class:"w-4 h-4"}),t[10]||(t[10]=p(" Tambah Materi ",-1))]),_:1})]),e("div",Fe,[e("div",Pe,[o(l(H),{class:"w-5 h-5 text-brand-orange"})]),t[11]||(t[11]=e("div",{class:"min-w-0"},[e("p",{class:"font-bold text-stone-900 mb-1 uppercase tracking-tight text-sm"},"Panduan Pengelolaan Materi"),e("ul",{class:"list-disc pl-5 text-xs text-stone-700 space-y-1 font-medium"},[e("li",null,"Materi PDF harus memiliki ukuran maksimal 20MB."),e("li",null,"Pastikan judul materi deskriptif dan mudah dicari oleh siswa."),e("li",null,"Video harus menggunakan link YouTube yang valid (Full atau Shortened)."),e("li",null,'Gunakan status "Aktif" untuk menampilkan materi di halaman publik secara instan.')])],-1))]),o(l(ne),{class:"border-2 border-black shadow-brutal rounded-none overflow-hidden"},{default:d(()=>[o(l(le),{class:"border-b-2 border-black bg-stone-100 p-4"},{default:d(()=>[o(l(ie),{class:"text-sm font-bold uppercase tracking-widest text-stone-900"},{default:d(()=>[...t[12]||(t[12]=[p("Daftar Materi Pembelajaran",-1)])]),_:1})]),_:1}),o(l(oe),{class:"p-0 overflow-x-auto bg-white"},{default:d(()=>[z.value?(r(),n("div",De,[o(l(B),{class:"w-8 h-8 animate-spin text-brand-teal mb-2"}),t[13]||(t[13]=e("span",{class:"font-mono text-xs uppercase tracking-widest text-stone-500"},"Memuat data...",-1))])):U.value.length===0?(r(),n("div",Te,[o(l(N),{class:"w-12 h-12 mx-auto mb-2 opacity-50"}),t[14]||(t[14]=e("p",null,"Belum ada materi pembelajaran",-1))])):(r(),n("table",Ve,[t[17]||(t[17]=e("thead",{class:"bg-lime-50 border-b-2 border-black text-[10px] font-bold uppercase tracking-widest"},[e("tr",null,[e("th",{class:"px-6 py-3"},"Materi"),e("th",{class:"px-6 py-3"},"Tipe"),e("th",{class:"px-6 py-3"},"Pengunggah"),e("th",{class:"px-6 py-3"},"Status"),e("th",{class:"px-6 py-3 text-right"},"Aksi")])],-1)),e("tbody",Se,[(r(!0),n(I,null,re(U.value,s=>(r(),n("tr",{key:s.materi_id,class:"hover:bg-stone-50 transition-colors"},[e("td",Ae,[e("div",Be,f(s.judul),1),e("div",Ue,f(s.deskripsi||"-"),1)]),e("td",ze,[s.tipe==="pdf"?(r(),m(l(O),{key:0,variant:"outline",class:"bg-red-50 text-red-700 border-red-200 uppercase text-[10px]"},{default:d(()=>[o(l(_e),{class:"w-3 h-3 mr-1"}),t[15]||(t[15]=p(" PDF ",-1))]),_:1})):(r(),m(l(O),{key:1,variant:"outline",class:"bg-blue-50 text-blue-700 border-blue-200 uppercase text-[10px]"},{default:d(()=>[o(l(ye),{class:"w-3 h-3 mr-1"}),t[16]||(t[16]=p(" VIDEO ",-1))]),_:1}))]),e("td",Ge,[e("div",Ee,[e("div",Ne,[s.creator?.image?(r(),n("img",{key:0,src:s.creator.image,class:"w-full h-full object-cover"},null,8,He)):$("",!0)]),e("span",Ie,f(s.creator?.name||"Admin"),1)])]),e("td",Ke,[e("button",{onClick:h=>Z(s),class:"flex items-center gap-2 group",disabled:k.value.has(s.materi_id)},[e("div",{class:C([s.is_active?"bg-green-500":"bg-stone-300","w-10 h-5 border-2 border-black rounded-full relative transition-colors",k.value.has(s.materi_id)?"opacity-50":""])},[e("div",{class:C([s.is_active?"translate-x-5":"translate-x-0","absolute top-0.5 left-0.5 w-3 h-3 bg-white border border-black rounded-full transition-transform"])},null,2)],2),e("span",{class:C([s.is_active?"text-green-700 font-bold":"text-stone-400","text-[10px] uppercase tracking-tighter flex items-center gap-1"])},[k.value.has(s.materi_id)?(r(),m(l(B),{key:0,class:"w-3 h-3 animate-spin"})):$("",!0),p(" "+f(s.is_active?"Aktif":"Nonaktif"),1)],2)],8,Le)]),e("td",Re,[e("div",Ye,[o(l(x),{variant:"outline",size:"sm",onClick:h=>E(s),class:"border-2 border-black p-2 h-8"},{default:d(()=>[o(l(we),{class:"w-3.5 h-3.5"})]),_:1},8,["onClick"]),o(l(x),{variant:"outline",size:"sm",onClick:h=>X(s),class:"border-2 border-black p-2 h-8 text-red-600 hover:bg-red-50"},{default:d(()=>[o(l(Y),{class:"w-3.5 h-3.5"})]),_:1},8,["onClick"])])])]))),128))])]))]),_:1})]),_:1})]),G.value?(r(),n("div",Oe,[e("div",{class:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:T}),e("div",Je,[e("div",We,[e("h2",qe,f(w.value?"Edit Materi":"Tambah Materi Baru"),1),e("button",{onClick:T,class:"p-1 hover:bg-stone-200 border-2 border-transparent hover:border-black transition-colors rounded"},[o(l(K),{class:"w-5 h-5"})])]),e("form",{onSubmit:de(q,["prevent"]),class:"p-6 space-y-5 max-h-[80vh] overflow-y-auto"},[b.value?(r(),n("div",Xe,f(b.value),1)):$("",!0),e("div",Qe,[e("div",null,[t[18]||(t[18]=e("label",{class:"block text-xs font-bold uppercase tracking-widest mb-1.5"},"Judul Materi *",-1)),o(l(L),{modelValue:i.value.judul,"onUpdate:modelValue":t[1]||(t[1]=s=>i.value.judul=s),placeholder:"Masukkan judul materi",class:"border-2 border-black focus-visible:ring-0"},null,8,["modelValue"])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-xs font-bold uppercase tracking-widest mb-1.5"},"Deskripsi Singkat",-1)),R(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=s=>i.value.deskripsi=s),rows:"3",placeholder:"Deskripsi materi...",class:"w-full p-2 border-2 border-black focus:outline-none text-sm"},null,512),[[ue,i.value.deskripsi]])]),e("div",Ze,[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-xs font-bold uppercase tracking-widest mb-1.5"},"Tipe Materi",-1)),e("div",et,[e("button",{type:"button",onClick:t[3]||(t[3]=s=>i.value.tipe="pdf"),class:C([i.value.tipe==="pdf"?"bg-brand-red text-white":"bg-white text-black","flex-1 py-1.5 text-xs font-bold uppercase tracking-tighter transition-colors"])}," PDF ",2),e("button",{type:"button",onClick:t[4]||(t[4]=s=>i.value.tipe="video"),class:C([i.value.tipe==="video"?"bg-[#FF0000] text-white":"bg-white text-black","flex-1 py-1.5 text-xs font-bold uppercase tracking-tighter transition-colors"])}," VIDEO ",2)])]),e("div",tt,[e("label",at,[R(e("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=s=>i.value.is_active=s),class:"w-4 h-4 border-2 border-black rounded-none"},null,512),[[ce,i.value.is_active]]),t[21]||(t[21]=e("span",{class:"text-xs font-bold uppercase tracking-widest"},"Tampilkan di Publik",-1))])])]),i.value.tipe==="pdf"?(r(),n("div",st,[t[24]||(t[24]=e("label",{class:"block text-xs font-bold uppercase tracking-widest mb-1.5"},"File PDF *",-1)),i.value.file_path?(r(),n("div",lt,[e("div",it,[o(l(pe),{class:"w-4 h-4 flex-shrink-0"}),e("span",ot,f(i.value.file_path.split("/").pop()),1)]),e("button",{type:"button",onClick:t[6]||(t[6]=s=>i.value.file_path=""),class:"text-green-700 hover:scale-110 transition-transform"},[o(l(K),{class:"w-4 h-4"})])])):(r(),n("div",rt,[e("div",nt,[e("input",{type:"file",accept:"application/pdf",onChange:W,class:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10",disabled:g.value},null,40,dt),e("div",ut,[g.value?(r(),n("div",ct,[e("div",pt,[t[22]||(t[22]=e("span",null,"MENGUNGGAH...",-1)),e("span",null,f(y.value)+"%",1)]),e("div",bt,[e("div",{class:"h-full bg-brand-teal transition-all",style:be({width:y.value+"%"})},null,4)])])):(r(),n(I,{key:1},[o(l(ve),{class:"w-6 h-6 mx-auto mb-2 text-stone-400"}),t[23]||(t[23]=e("p",{class:"text-[10px] font-bold uppercase text-stone-500 tracking-widest"},"Klik atau seret file PDF",-1))],64))])])]))])):(r(),n("div",vt,[t[25]||(t[25]=e("label",{class:"block text-xs font-bold uppercase tracking-widest mb-1.5"},"URL YouTube *",-1)),o(l(L),{modelValue:i.value.video_url,"onUpdate:modelValue":t[7]||(t[7]=s=>i.value.video_url=s),placeholder:"https://youtube.com/watch?v=...",class:"border-2 border-black focus-visible:ring-0"},null,8,["modelValue"]),t[26]||(t[26]=e("p",{class:"text-[10px] text-stone-500 mt-1 italic tracking-tight"},"Gunakan link full atau shortened (youtu.be)",-1))]))]),e("div",ft,[o(l(x),{type:"button",variant:"outline",class:"flex-1 border-2 border-black",onClick:T,disabled:_.value},{default:d(()=>[...t[27]||(t[27]=[p(" Batal ",-1)])]),_:1},8,["disabled"]),o(l(x),{type:"submit",class:"flex-1 gap-2 border-2 border-black shadow-brutal-sm",disabled:_.value||g.value},{default:d(()=>[_.value?(r(),m(l(B),{key:0,class:"w-4 h-4 animate-spin"})):(r(),m(l(he),{key:1,class:"w-4 h-4"})),t[28]||(t[28]=p(" Simpan Materi ",-1))]),_:1},8,["disabled"])])],32)])])):$("",!0),V.value?(r(),n("div",mt,[t[34]||(t[34]=e("div",{class:"absolute inset-0 bg-black/60 backdrop-blur-sm"},null,-1)),e("div",xt,[e("div",gt,[o(l(H),{class:"w-6 h-6"}),t[29]||(t[29]=e("h3",{class:"font-bold text-lg uppercase tracking-tight"},"Hapus Materi?",-1))]),e("p",kt,[t[30]||(t[30]=p("Apakah Anda yakin ingin menghapus materi ",-1)),e("span",ht,'"'+f(M.value?.judul)+'"',1),t[31]||(t[31]=p("? Tindakan ini tidak dapat dibatalkan.",-1))]),e("div",_t,[o(l(x),{variant:"outline",class:"flex-1 border-2 border-black",onClick:t[8]||(t[8]=s=>V.value=!1)},{default:d(()=>[...t[32]||(t[32]=[p("Batal",-1)])]),_:1}),o(l(x),{class:"flex-1 bg-red-600 hover:bg-red-700 text-white border-2 border-black gap-2",onClick:Q,disabled:P.value},{default:d(()=>[P.value?(r(),m(l(B),{key:0,class:"w-4 h-4 animate-spin"})):(r(),m(l(Y),{key:1,class:"w-4 h-4"})),t[33]||(t[33]=p(" Hapus ",-1))]),_:1},8,["disabled"])])])])):$("",!0)]),_:1}))}},Vt=te(yt,[["__scopeId","data-v-49cb4037"]]);export{Vt as default};
