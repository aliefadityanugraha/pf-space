import{e as D,r as p,a6 as P,t as _,f as q,c as f,w as v,a as e,g as b,h as c,k as o,n as k,p as $,O as A,C as d,F,q as I,m as G,v as Y,N as J,R as U,E as z,o as l,D as T,a3 as Z,aw as Q,aj as W,B as V,L as X,A as N,H as ee}from"./index-CtvPx6GS.js";import{_ as te}from"./PageLayout-D3yfzHYG.js";import{_ as se,T as j}from"./LoadingState-jGdAhDdo.js";import{F as ae}from"./funnel-DqJbB2r8.js";const oe=D("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);const R=D("trophy",[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]]),L=p([]),C=p([]),ne=p(!1);function re(){const w=p(!1),{isLoggedIn:h}=P();return{films:L,categories:C,isLoading:w,fetchFilms:async()=>{w.value=!0;try{const x=await _.get("/api/categories");x.success?C.value=[{id:"all",name:"Semua Karya"},...x.data.map(a=>({id:a.category_id,name:a.nama_kategori}))]:C.value=[{id:"all",name:"Semua Karya"}];const m=await _.get("/api/votes/trending?period=all&limit=100");let i=[];m.success&&(i=m.data);let u=[];if(h.value)try{const a=await _.get("/api/votes/my-votes");a.success&&(u=a.data.map(y=>y.film_id))}catch(a){console.error("Failed to fetch user votes",a)}L.value=i.map(a=>({id:a.film_id,slug:a.slug,title:a.judul,year:a.tahun_karya,director:a.creator?.name||a.creator?.username||"Unknown",votes:parseInt(a.vote_count||0),category:a.category?.category_id,categoryName:a.category?.nama_kategori||"Uncategorized",image:a.gambar_poster||"https://placehold.co/300x450/1c1917/f5f5f4?text=No+Image",hasVoted:u.includes(a.film_id)})),ne.value=!0}catch(x){console.error("Failed to fetch voting data:",x)}finally{w.value=!1}},voteFilm:async x=>{if(!h.value)return{success:!1,error:"unauthorized",message:"Please login to vote"};try{const m=await _.post(`/api/votes/${x}`);if(m.success){const i=L.value.find(u=>u.id===x);return i&&(i.votes=m.data.vote_count,i.hasVoted=!0),{success:!0}}return{success:!1,message:m.message}}catch(m){return{success:!1,error:m,message:m.message||"Failed to vote"}}}}}const le={class:"max-w-7xl mx-auto px-4 md:px-8 mt-12 mb-16"},de={class:"text-center mb-8 md:mb-12"},ie={class:"inline-flex items-center gap-2 bg-brand-red border-2 border-stone-900 shadow-brutal px-3 py-1 md:px-4 md:py-1 mb-3 md:mb-4"},ce={key:0,class:"mb-16"},me={class:"flex flex-col md:flex-row items-end justify-center gap-4 md:gap-6"},ue={key:0,class:"order-2 md:order-1 w-full md:w-56 max-w-[280px] md:max-w-none"},xe={class:"bg-white border-2 border-stone-900 shadow-brutal p-3 md:p-4 text-center"},be=["src","alt"],he={class:"font-display text-base md:text-lg text-stone-900 truncate"},ve={class:"font-body text-xs md:text-sm text-stone-500"},pe={class:"flex items-center justify-center gap-1 mt-1.5 md:mt-2"},ge={class:"font-body font-bold text-sm md:text-stone-900"},fe={key:1,class:"order-1 md:order-2 w-full md:w-64 max-w-[320px] md:max-w-none"},ye={class:"bg-white border-2 border-stone-900 shadow-brutal-lg p-3 md:p-4 text-center relative"},we={class:"absolute -top-3 md:-top-4 left-1/2 -translate-x-1/2"},_e={class:"w-10 h-10 md:w-14 md:h-14 bg-yellow-400 border-2 border-stone-900 shadow-brutal-xs md:shadow-brutal-sm flex items-center justify-center"},ke={class:"pt-6 md:pt-8"},Ae=["src","alt"],Fe={class:"font-display text-lg md:text-xl text-stone-900 truncate"},Te={class:"font-body text-xs md:text-sm text-stone-500"},Ve={class:"flex items-center justify-center gap-1 mt-1.5 md:mt-2"},je={class:"font-body font-bold text-base md:text-lg text-stone-900"},Le={key:2,class:"order-3 w-full md:w-52 max-w-[260px] md:max-w-none"},Ce={class:"bg-white border-2 border-stone-900 shadow-brutal p-3 md:p-4 text-center"},Me=["src","alt"],Se={class:"font-display text-base md:text-lg text-stone-900 truncate"},Be={class:"font-body text-xs md:text-sm text-stone-500"},$e={class:"flex items-center justify-center gap-1 mt-1.5 md:mt-2"},Ie={class:"font-body font-bold text-sm md:text-stone-900"},Ue={class:"flex flex-col md:flex-row gap-4 mb-8"},ze={class:"flex flex-wrap gap-2"},Ne=["onClick"],Re={class:"flex items-center gap-2 md:ml-auto"},De={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"},He={class:"flex items-center justify-between w-full border-t-2 border-stone-200 pt-3"},Ke={class:"flex items-center gap-2"},Ee={class:"font-body font-bold text-stone-900"},Oe={class:"mt-12 md:mt-16 bg-stone-900 border-2 border-stone-900 p-6 md:p-12 text-center shadow-brutal-sm"},Je={__name:"Trending",setup(w){const{films:h,categories:M,isLoading:S,fetchFilms:x,voteFilm:m}=re(),i=p("all"),u=p("votes"),a=p(null),{showToast:y}=ee();q(()=>{x()});const B=$(()=>{let r=[...h.value];return i.value!=="all"&&(r=r.filter(t=>t.category===i.value)),u.value==="votes"?r.sort((t,s)=>s.votes-t.votes):u.value==="year"?r.sort((t,s)=>t.year-s.year):u.value==="title"&&r.sort((t,s)=>t.title.localeCompare(s.title)),r}),n=$(()=>[...h.value].sort((r,t)=>t.votes-r.votes).slice(0,3)),H=async r=>{if(!r.hasVoted){a.value=r.id;const t=await m(r.id);a.value=null,t.success?y("Terima kasih atas voting Anda!"):t.error==="unauthorized"?y("Silakan login untuk memberikan voting","error"):y(t.message||"Gagal memberikan voting","error")}},K=r=>r===0?"bg-yellow-400 text-stone-900":r===1?"bg-stone-400 text-stone-900":r===2?"bg-amber-600 text-white":"bg-stone-200 text-stone-700";return(r,t)=>(l(),f(te,null,{default:v(()=>[e("div",le,[e("div",de,[e("div",ie,[c(o(R),{class:"w-4 h-4 md:w-5 md:h-5 text-white"}),t[2]||(t[2]=e("span",{class:"font-body text-white text-[10px] md:text-sm font-bold uppercase tracking-widest"},"Pilihan Komunitas",-1))]),t[3]||(t[3]=e("h1",{class:"font-heading text-3xl md:text-7xl text-stone-900 tracking-wide mb-3 md:mb-4"}," PILIH KARYA FAVORITMU ",-1)),t[4]||(t[4]=e("p",{class:"font-body text-stone-600 text-sm md:text-lg max-w-2xl mx-auto px-4 md:px-0"}," Bantu kami mengkurasi arsip terbaik. Beri suara untuk karya yang layak diarsipkan dan dirayakan. ",-1))]),o(S)&&o(h).length===0?(l(),f(se,{key:0,text:"MEMUAT DATA VOTING...",color:"orange"})):(l(),b(F,{key:1},[n.value.length>0?(l(),b("div",ce,[t[7]||(t[7]=e("h2",{class:"font-display text-2xl text-stone-900 mb-6 text-center"},"Peringkat Sementara",-1)),e("div",me,[n.value[1]?(l(),b("div",ue,[e("div",xe,[t[5]||(t[5]=e("div",{class:"w-10 h-10 md:w-12 md:h-12 bg-stone-400 border-2 border-stone-900 mx-auto mb-2 md:mb-3 flex items-center justify-center"},[e("span",{class:"font-heading text-xl md:text-2xl text-stone-900"},"2")],-1)),e("img",{src:o(A)(n.value[1].image),alt:n.value[1].title,class:"w-full aspect-[2/3] object-cover border-2 border-stone-900 mb-2 md:mb-3"},null,8,be),e("h3",he,d(n.value[1].title),1),e("p",ve,d(n.value[1].year),1),e("div",pe,[c(o(j),{class:"w-3.5 h-3.5 md:w-4 md:h-4 text-brand-teal"}),e("span",ge,d(n.value[1].votes.toLocaleString()),1)])])])):k("",!0),n.value[0]?(l(),b("div",fe,[e("div",ye,[e("div",we,[e("div",_e,[c(o(R),{class:"w-5 h-5 md:w-7 md:h-7 text-stone-900"})])]),e("div",ke,[e("img",{src:o(A)(n.value[0].image),alt:n.value[0].title,class:"w-full aspect-[2/3] object-cover border-2 border-stone-900 mb-2 md:mb-3"},null,8,Ae),e("h3",Fe,d(n.value[0].title),1),e("p",Te,d(n.value[0].year),1),e("div",Ve,[c(o(j),{class:"w-4 h-4 md:w-5 md:h-5 text-brand-teal"}),e("span",je,d(n.value[0].votes.toLocaleString()),1)])])])])):k("",!0),n.value[2]?(l(),b("div",Le,[e("div",Ce,[t[6]||(t[6]=e("div",{class:"w-10 h-10 md:w-12 md:h-12 bg-amber-600 border-2 border-stone-900 mx-auto mb-2 md:mb-3 flex items-center justify-center"},[e("span",{class:"font-heading text-xl md:text-2xl text-white"},"3")],-1)),e("img",{src:o(A)(n.value[2].image),alt:n.value[2].title,class:"w-full aspect-[2/3] object-cover border-2 border-stone-900 mb-2 md:mb-3"},null,8,Me),e("h3",Se,d(n.value[2].title),1),e("p",Be,d(n.value[2].year),1),e("div",$e,[c(o(j),{class:"w-3.5 h-3.5 md:w-4 md:h-4 text-brand-teal"}),e("span",Ie,d(n.value[2].votes.toLocaleString()),1)])])])):k("",!0)])])):k("",!0),e("div",Ue,[e("div",ze,[(l(!0),b(F,null,I(o(M),s=>(l(),b("button",{key:s.id,onClick:E=>i.value=s.id,class:T(["px-4 py-2 border-2 border-stone-900 font-body text-sm font-bold uppercase tracking-wide transition-all",i.value===s.id?"bg-brand-teal text-white shadow-brutal-sm":"bg-white text-stone-700 hover:bg-stone-100"])},d(s.name),11,Ne))),128))]),e("div",Re,[c(o(ae),{class:"w-4 h-4 text-stone-500"}),G(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>u.value=s),class:"bg-white border-2 border-stone-900 px-3 py-2 font-body text-sm font-bold uppercase tracking-wide focus:outline-none focus:ring-2 focus:ring-brand-teal"},[...t[8]||(t[8]=[e("option",{value:"votes"},"Suara Terbanyak",-1),e("option",{value:"year"},"Terlama Lebih Dulu",-1),e("option",{value:"title"},"Judul A-Z",-1)])],512),[[Y,u.value]])])]),B.value.length>0?(l(),b("div",De,[(l(!0),b(F,null,I(B.value,(s,E)=>(l(),f(Z,{key:s.id,archive:s,subtitle:`${s.director} Â· ${s.year}`,"show-play-overlay":!1,class:"hover:translate-x-[-2px] hover:translate-y-[-2px] hover:shadow-brutal-lg"},{overlay:v(()=>[c(o(N),{class:T(["absolute top-2 left-2 border-2 border-stone-900",K(o(h).findIndex(g=>g.id===s.id))])},{default:v(()=>[V(" #"+d(o(h).sort((g,O)=>O.votes-g.votes).findIndex(g=>g.id===s.id)+1),1)]),_:2},1032,["class"])]),"extra-content":v(()=>[c(o(N),{variant:"outline",class:"text-xs mb-3"},{default:v(()=>[V(d(s.categoryName),1)]),_:2},1024)]),actions:v(()=>[e("div",He,[e("div",Ke,[c(o(Q),{class:"w-4 h-4 text-brand-teal"}),e("span",Ee,d(s.votes.toLocaleString()),1),t[9]||(t[9]=e("span",{class:"font-body text-xs text-stone-500"},"apresiasi",-1))]),c(o(z),{onClick:W(g=>H(s),["stop"]),disabled:s.hasVoted||a.value===s.id,class:T(["border-2 border-stone-900 transition-all",s.hasVoted?"bg-stone-200 text-stone-500 cursor-not-allowed":"bg-brand-red text-white shadow-brutal-sm hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none"]),size:"sm"},{default:v(()=>[a.value===s.id?(l(),f(o(X),{key:0,class:"w-4 h-4 mr-1 animate-spin"})):(l(),f(o(oe),{key:1,class:"w-4 h-4 mr-1"})),V(" "+d(s.hasVoted?"Sudah Diapresiasi":"Beri Apresiasi"),1)]),_:2},1032,["onClick","disabled","class"])])]),_:2},1032,["archive","subtitle"]))),128))])):(l(),f(J,{key:2,icon:o(U),title:"Belum ada film di kategori ini",description:"Coba pilih kategori lain atau lihat semua film yang bisa kamu vote.","action-label":"Lihat Semua Film",variant:"dashed",onAction:t[1]||(t[1]=s=>i.value="all")},null,8,["icon"]))],64)),e("div",Oe,[c(o(U),{class:"w-10 h-10 md:w-12 md:h-12 text-brand-orange mx-auto mb-4"}),t[11]||(t[11]=e("h2",{class:"font-heading text-xl md:text-4xl text-white tracking-wide mb-3 md:mb-4"}," BELUM ADA KARYA FAVORITMU? ",-1)),t[12]||(t[12]=e("p",{class:"font-body text-[11px] md:text-base text-stone-400 mb-6 max-w-lg mx-auto"}," Ajukan karya untuk ditambahkan ke koleksi trending dan bantu memperkaya arsip. ",-1)),c(o(z),{class:"bg-brand-orange text-stone-900 border-2 border-white shadow-brutal-white hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none transition-all px-6 py-2 md:py-3 h-9 md:h-auto text-xs md:text-base"},{default:v(()=>[...t[10]||(t[10]=[e("span",{class:"font-body font-bold uppercase tracking-wide"},"Ajukan Karya",-1)])]),_:1})])])]),_:1}))}};export{Je as default};
