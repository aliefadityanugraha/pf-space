import{g as m,n as h,o as i,h as t,w as n,a as l,k as a,ao as J,E as b,B as p,C as f,Q as W,u as Z,f as ee,c as k,a9 as ae,G as se,z as te,A as P,r as g,D as A,af as H,q as R,F as N,T as le,a8 as q,a2 as E,ai as ne,ap as G,X as oe,t as T,H as ie,aq as re,ar as de,ae as ue,O as ce,Y as me}from"./index-CdiZ0yiz.js";import{_ as pe}from"./PageLayout-CDEHN9R7.js";import{_ as fe}from"./PageHeader-CXGgszjw.js";import{P as U}from"./plus-BgJKWeAU.js";import{C as ge}from"./clock-BRDTloS5.js";import{P as ve}from"./pencil-C9LI9NL2.js";const be={key:0,class:"flex items-center justify-center gap-4 mt-8"},ye={key:0,class:"text-sm text-stone-600 font-body"},ke={class:"font-bold"},he={class:"font-bold"},xe={__name:"Pagination",props:{page:{type:Number,required:!0},totalPages:{type:Number,required:!0},total:{type:Number,default:0},limit:{type:Number,default:10},showInfo:{type:Boolean,default:!0},size:{type:String,default:"sm",validator:d=>["sm","md"].includes(d)}},emits:["update:page","change"],setup(d,{emit:x}){const _=d,w=x,c=u=>{u>=1&&u<=_.totalPages&&(w("update:page",u),w("change",u))};return(u,r)=>d.totalPages>1?(i(),m("div",be,[t(a(b),{variant:"outline",size:d.size,disabled:d.page<=1,onClick:r[0]||(r[0]=v=>c(d.page-1)),class:"border-2 border-stone-300"},{default:n(()=>[t(a(J),{class:"w-4 h-4"}),r[2]||(r[2]=l("span",{class:"hidden sm:inline ml-1"},"Sebelumnya",-1))]),_:1},8,["size","disabled"]),d.showInfo?(i(),m("span",ye,[r[3]||(r[3]=p(" Halaman ",-1)),l("span",ke,f(d.page),1),r[4]||(r[4]=p(" dari ",-1)),l("span",he,f(d.totalPages),1)])):h("",!0),t(a(b),{variant:"outline",size:d.size,disabled:d.page>=d.totalPages,onClick:r[1]||(r[1]=v=>c(d.page+1)),class:"border-2 border-stone-300"},{default:n(()=>[r[5]||(r[5]=l("span",{class:"hidden sm:inline mr-1"},"Berikutnya",-1)),t(a(W),{class:"w-4 h-4"})]),_:1},8,["size","disabled"])])):h("",!0)}},_e={class:"max-w-7xl mx-auto px-4 md:px-8 pb-16"},we={class:"flex flex-wrap gap-2 items-center"},$e={class:"font-bold mr-1"},Ce={class:"font-bold mr-1"},je={class:"font-bold mr-1"},Pe={class:"font-bold mr-1"},Se={class:"flex gap-2 mb-6 flex-wrap"},ze={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Be={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Fe={class:"text-xs text-stone-400 mb-4"},De={key:0,class:"p-2 bg-red-50 border border-red-200 text-red-600 text-xs mb-4 rounded"},Ae={key:0},Ke={class:"line-clamp-2"},Le=["onClick"],Me={key:1},Re={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Ne={class:"relative bg-white border-2 border-black shadow-brutal w-full max-w-lg"},Te={class:"flex items-center justify-between px-6 py-4 border-b-2 border-black bg-red-50"},He={class:"flex items-center gap-3"},qe={class:"p-6 max-h-[70vh] overflow-y-auto"},Ee={class:"font-bold text-lg mb-2"},Ge={class:"p-4 bg-stone-50 border border-stone-200 rounded text-stone-700 whitespace-pre-wrap text-sm"},Ue={class:"mt-6 flex justify-end"},Je={__name:"MyArchive",setup(d){Z({title:"Manajemen Karya Saya - PF Space"});const x=ae(),_=g([]),w=g(!0),c=g({page:1,limit:10,total:0,totalPages:0}),u=g("all"),r=g({all:0,pending:0,published:0,rejected:0}),v=g(!1),S=g(!1),C=g(null),K=g(!1),j=g(!1),z=g(null),{showToast:B}=ie(),V=o=>{z.value=o,j.value=!0},F={pending:"bg-yellow-100 text-yellow-800 border-yellow-300",published:"bg-green-100 text-green-800 border-green-300",rejected:"bg-red-100 text-red-800 border-red-300"},L={pending:"Menunggu Review",published:"Dipublikasi",rejected:"Ditolak"},D=async()=>{w.value=!0;try{const o=new URLSearchParams;o.append("page",c.value.page),o.append("limit",c.value.limit),u.value!=="all"&&o.append("status",u.value);const e=await T.get(`/api/films/my-films?${o}`);_.value=e.data,e.pagination&&(c.value={...c.value,...e.pagination})}catch(o){console.error("Failed to fetch films:",o),B("Gagal memuat data film","error")}finally{w.value=!1}},I=async()=>{v.value=!0;try{const e=["all","pending","published","rejected"].map($=>T.get("/api/films/my-films",{params:{page:1,limit:1,status:$==="all"?void 0:$}}).then(M=>({status:$,total:M.pagination?.total||(Array.isArray(M.data)?M.data.length:0)}))),s=await Promise.all(e),y={all:0,pending:0,published:0,rejected:0};for(const $ of s)y[$.status]=$.total;r.value=y}catch(o){console.error("Failed to fetch film status summary:",o),B("Gagal memuat ringkasan status film","error")}finally{v.value=!1}},X=o=>{C.value=o,S.value=!0},O=async()=>{if(C.value){K.value=!0;try{await T.delete(`/api/films/${C.value.film_id}`),B("Film berhasil dihapus"),S.value=!1,await D()}catch(o){B(o.message||"Gagal menghapus film","error")}finally{K.value=!1,C.value=null}}},Q=o=>{u.value=o,c.value.page=1,D()},Y=o=>{o>=1&&o<=c.value.totalPages&&(c.value.page=o,D())};return ee(async()=>{await Promise.all([D(),I()])}),(o,e)=>(i(),k(pe,null,{default:n(()=>[l("main",_e,[t(fe,{title:"Karya Saya",description:"Kelola semua karya yang sudah kamu upload."},{actions:n(()=>[t(a(b),{onClick:e[0]||(e[0]=s=>a(x).push("/upload")),class:"gap-2"},{default:n(()=>[t(a(U),{class:"w-4 h-4"}),e[6]||(e[6]=p(" Upload Karya Baru ",-1))]),_:1})]),_:1}),t(H,{name:"Ringkasan Status"},{default:n(()=>[t(a(se),{class:"mb-6"},{default:n(()=>[t(a(te),{class:"p-4 flex flex-col md:flex-row md:items-center md:justify-between gap-4"},{default:n(()=>[e[11]||(e[11]=l("div",null,[l("p",{class:"text-xs font-bold uppercase tracking-wider text-stone-600 mb-1"},"Status Pengajuan Karya"),l("p",{class:"text-sm text-stone-500"}," Ringkasan semua karya yang kamu upload berdasarkan status review. ")],-1)),l("div",we,[t(a(P),{variant:"outline",class:"bg-stone-900 text-white border-stone-900"},{default:n(()=>[l("span",$e,f(v.value?"…":r.value.all),1),e[7]||(e[7]=p(" Total ",-1))]),_:1}),t(a(P),{class:A(F.pending)},{default:n(()=>[l("span",Ce,f(v.value?"…":r.value.pending),1),e[8]||(e[8]=p(" Menunggu ",-1))]),_:1},8,["class"]),t(a(P),{class:A(F.published)},{default:n(()=>[l("span",je,f(v.value?"…":r.value.published),1),e[9]||(e[9]=p(" Dipublikasi ",-1))]),_:1},8,["class"]),t(a(P),{class:A(F.rejected)},{default:n(()=>[l("span",Pe,f(v.value?"…":r.value.rejected),1),e[10]||(e[10]=p(" Ditolak ",-1))]),_:1},8,["class"])])]),_:1})]),_:1})]),_:1}),l("div",Se,[(i(),m(N,null,R(["all","pending","published","rejected"],s=>t(a(b),{key:s,variant:u.value===s?"default":"outline",size:"sm",onClick:y=>Q(s),class:"gap-2"},{default:n(()=>[s==="pending"?(i(),k(a(ge),{key:0,class:"w-4 h-4"})):s==="published"?(i(),k(a(re),{key:1,class:"w-4 h-4"})):s==="rejected"?(i(),k(a(G),{key:2,class:"w-4 h-4"})):(i(),k(a(q),{key:3,class:"w-4 h-4"})),p(" "+f(s==="all"?"Semua":L[s]),1)]),_:2},1032,["variant","onClick"])),64))]),w.value?(i(),m("div",ze,[(i(),m(N,null,R(6,s=>t(de,{key:s,variant:"landscape"})),64))])):_.value.length===0?(i(),k(le,{key:1,icon:a(q),title:u.value==="all"?"Belum ada karya":`Belum ada karya dengan status ${L[u.value]}`,description:u.value==="all"?"Mulai upload karya pertamamu sekarang!":"Coba pilih status lain atau upload karya baru.",actionLabel:"Upload Karya",onAction:e[1]||(e[1]=s=>a(x).push("/upload"))},{"action-icon":n(()=>[t(a(U),{class:"w-4 h-4"})]),_:1},8,["icon","title","description"])):h("",!0),t(H,{name:"Daftar Karya"},{default:n(()=>[_.value.length>0?(i(),m("div",Be,[(i(!0),m(N,null,R(_.value,s=>(i(),k(ue,{key:s.film_id,archive:s,variant:"landscape","show-play-overlay":!1},{overlay:n(()=>[t(a(P),{class:A(["absolute top-2 right-2",F[s.status]])},{default:n(()=>[p(f(L[s.status]),1)]),_:2},1032,["class"])]),"extra-content":n(()=>[l("p",Fe,f(s.tahun_karya||"-"),1),s.status==="rejected"?(i(),m("div",De,[e[12]||(e[12]=l("p",{class:"font-semibold mb-1"},"Karya ditolak admin.",-1)),s.rejection_reason?(i(),m("div",Ae,[l("p",Ke," Alasan: "+f(s.rejection_reason),1),s.rejection_reason.length>60?(i(),m("button",{key:0,onClick:me(y=>V(s),["stop"]),class:"text-red-800 font-bold underline mt-1 hover:text-red-950"}," Lihat Alasan Lengkap ",8,Le)):h("",!0)])):(i(),m("p",Me," Silakan periksa kembali kualitas konten, format file, dan kelengkapan data lalu submit ulang. "))])):h("",!0)]),actions:n(()=>[t(a(b),{variant:"outline",size:"sm",class:"flex-1 gap-1",onClick:y=>a(x).push(`/archive/${s.slug}`)},{default:n(()=>[t(a(ce),{class:"w-4 h-4"}),e[13]||(e[13]=p(" Lihat ",-1))]),_:1},8,["onClick"]),t(a(b),{variant:"outline",size:"sm",class:"flex-1 gap-1",onClick:y=>a(x).push(`/edit-archive/${s.slug}`)},{default:n(()=>[t(a(ve),{class:"w-4 h-4"}),e[14]||(e[14]=p(" Edit ",-1))]),_:1},8,["onClick"]),t(a(b),{variant:"outline",size:"sm",class:"text-red-600 hover:bg-red-50",onClick:y=>X(s)},{default:n(()=>[t(a(E),{class:"w-4 h-4"})]),_:1},8,["onClick"])]),_:2},1032,["archive"]))),128))])):h("",!0)]),_:1}),t(xe,{page:c.value.page,"total-pages":c.value.totalPages,onChange:Y},null,8,["page","total-pages"])]),t(ne,{show:S.value,"onUpdate:show":e[2]||(e[2]=s=>S.value=s),title:"Hapus Karya",message:`Hapus karya '${C.value?.judul}'? Aksi ini tidak dapat dibatalkan.`,"confirm-label":"Hapus",variant:"danger",loading:K.value,onConfirm:O},{"confirm-icon":n(()=>[t(a(E),{class:"w-4 h-4"})]),_:1},8,["show","message","loading"]),j.value&&z.value?(i(),m("div",Re,[l("div",{class:"absolute inset-0 bg-black/50",onClick:e[3]||(e[3]=s=>j.value=!1)}),l("div",Ne,[l("div",Te,[l("div",He,[t(a(G),{class:"w-5 h-5 text-red-600"}),e[15]||(e[15]=l("h2",{class:"font-bold text-lg text-red-800"},"Alasan Penolakan",-1))]),l("button",{onClick:e[4]||(e[4]=s=>j.value=!1),class:"p-1 hover:bg-red-100 rounded"},[t(a(oe),{class:"w-5 h-5 text-red-800"})])]),l("div",qe,[l("h3",Ee,f(z.value.judul),1),l("div",Ge,f(z.value.rejection_reason),1),l("div",Ue,[t(a(b),{onClick:e[5]||(e[5]=s=>j.value=!1)},{default:n(()=>[...e[16]||(e[16]=[p("Tutup",-1)])]),_:1})])])])])):h("",!0)]),_:1}))}};export{Je as default};
