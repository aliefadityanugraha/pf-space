import{f as Z,g as r,a as s,h as a,n as F,w as n,B as m,a2 as ee,k as t,A as S,E as f,a5 as V,z as K,G as J,r as u,C as d,ao as L,Y as se,l as te,aR as ae,c as _,L as z,ap as le,aI as ie,aJ as oe,F as O,q as P,am as ne,a7 as U,t as x,H as re,o,D as ue,O as de,aC as ce,U as me,V as ve,ai as fe}from"./index-dv4JYaCV.js";import{_ as pe}from"./PageHeader-BXV2DCDM.js";import{P as be}from"./plus-CKJPh2TZ.js";import{S as ke}from"./square-pen-CDoPmooZ.js";const _e={class:"p-4 md:p-8"},xe={class:"flex items-center gap-2 text-xs font-mono uppercase tracking-wider mb-4"},ge={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},he={class:"relative bg-white border-2 border-black shadow-brutal w-full max-w-2xl mx-4"},ye={class:"flex items-center justify-between px-6 py-4 border-b-2 border-black bg-stone-100"},we={class:"font-bold text-lg"},Ce={class:"flex gap-3 pt-4"},De={class:"flex items-center gap-3"},$e={key:0,class:"flex items-center justify-center py-12"},Be={key:1,class:"text-center py-12 text-stone-400"},je={class:"flex items-start justify-between gap-4"},Fe={class:"flex-1"},Ve={class:"flex items-center gap-3 mb-2"},ze={class:"text-lg font-bold text-stone-900"},Te={key:0,class:"text-stone-600 text-sm mb-3"},Ae={class:"flex items-center gap-4 text-xs text-stone-500"},Ee=["onClick"],Ge={class:"flex gap-2"},He={key:1,class:"fixed inset-0 z-50 flex items-center justify-center"},Me={class:"relative bg-white border-2 border-black shadow-brutal w-full max-w-sm mx-4"},Ue={class:"flex items-center gap-3 px-6 py-4 border-b-2 border-black bg-red-50"},Ne={class:"font-bold text-lg text-red-800"},Re={class:"p-6"},Se={class:"text-stone-600 mb-6"},Ke={class:"flex gap-3"},Je={key:2,class:"fixed inset-0 z-50 flex items-center justify-center"},Le={class:"relative bg-white border-2 border-black shadow-brutal w-full max-w-3xl mx-4 max-h-[80vh] flex flex-col"},Oe={class:"flex items-center justify-between px-6 py-4 border-b-2 border-black bg-stone-100"},Pe={class:"text-sm text-stone-600 mt-1"},qe={class:"flex-1 overflow-y-auto p-6"},Ie={key:0,class:"flex items-center justify-center py-12"},Xe={key:1,class:"text-center py-12 text-stone-400"},Ye={key:2,class:"space-y-4"},Qe={class:"w-10 h-10 bg-brand-teal border-2 border-black shadow-brutal-sm flex items-center justify-center flex-shrink-0 overflow-hidden"},We=["src","alt"],Ze={class:"flex-1 min-w-0"},es={class:"flex items-center justify-between gap-2 mb-2"},ss={class:"flex items-center gap-2 text-sm"},ts={class:"font-bold text-stone-900"},as={class:"text-stone-500 text-xs"},ls={class:"text-stone-700 text-sm whitespace-pre-wrap break-words"},is={class:"border-t-2 border-black p-4 bg-stone-50"},cs={__name:"CommunityDiscussions",setup(os){const w=u([]),T=u(!0),A=u(!1),b=u(null),C=u(!1),h=u(!1),E=u(!1),D=u(null),k=u([]),G=u(!1),v=u({title:"",description:""}),{showToast:c}=re(),y=u(!1),H=u({title:"",message:"",onConfirm:null}),$=u(null),B=async()=>{T.value=!0;try{const i=await x.get("/api/community");w.value=i.data||[]}catch(i){console.error("Failed to fetch discussions:",i),c("Gagal memuat diskusi","error")}finally{T.value=!1}},N=(i=null)=>{i?(b.value=i.discussion_id,v.value={title:i.title,description:i.description||""}):(b.value=null,v.value={title:"",description:""}),A.value=!0},j=()=>{A.value=!1,b.value=null,v.value={title:"",description:""}},q=async()=>{if(!v.value.title.trim()){c("Judul diskusi harus diisi","error");return}C.value=!0;try{b.value?(await x.put(`/api/community/${b.value}`,v.value),c("Diskusi berhasil diperbarui")):(await x.post("/api/community",v.value),c("Diskusi berhasil dibuat")),await B(),j()}catch(i){console.error("Failed to save discussion:",i),c("Gagal menyimpan diskusi","error")}finally{C.value=!1}},I=async(i,e)=>{try{await x.patch(`/api/community/${i}/toggle`,{is_active:!e}),c(`Diskusi berhasil ${e?"dinonaktifkan":"diaktifkan"}`),await B()}catch(p){console.error("Failed to toggle discussion:",p),c("Gagal mengubah status diskusi","error")}},X=i=>{$.value=i,H.value={title:"Hapus Diskusi",message:`Apakah Anda yakin ingin menghapus diskusi "${i.title}"? Semua balasan akan ikut terhapus.`},y.value=!0},Y=async()=>{if($.value){h.value=!0;try{await x.delete(`/api/community/${$.value.discussion_id}`),c("Diskusi berhasil dihapus"),await B()}catch(i){console.error("Failed to delete discussion:",i),c("Gagal menghapus diskusi","error")}finally{h.value=!1,y.value=!1,$.value=null}}},R=i=>{try{return fe(i)}catch{return"baru saja"}},Q=async i=>{D.value=i,E.value=!0,G.value=!0;try{const e=await x.get(`/api/community/${i.discussion_id}/replies`);k.value=e.data||[]}catch(e){console.error("Failed to fetch replies:",e),c("Gagal memuat balasan","error"),k.value=[]}finally{G.value=!1}},M=()=>{E.value=!1,D.value=null,k.value=[]},W=async i=>{if(confirm("Hapus balasan ini?"))try{await x.delete(`/api/community/replies/${i}/moderate`),c("Balasan berhasil dihapus"),k.value=k.value.filter(p=>p.reply_id!==i);const e=w.value.find(p=>p.discussion_id===D.value.discussion_id);e&&(e.reply_count=Math.max(0,(e.reply_count||0)-1))}catch(e){console.error("Failed to delete reply:",e),c("Gagal menghapus balasan","error")}};return Z(()=>{B()}),(i,e)=>{const p=ee("router-link");return o(),r("div",_e,[s("nav",xe,[a(p,{to:"/",class:"text-brand-teal hover:underline"},{default:n(()=>[...e[6]||(e[6]=[m("Beranda",-1)])]),_:1}),e[9]||(e[9]=s("span",{class:"text-stone-400"},"/",-1)),a(p,{to:"/admin",class:"text-stone-600 hover:underline"},{default:n(()=>[...e[7]||(e[7]=[m("Administrasi",-1)])]),_:1}),e[10]||(e[10]=s("span",{class:"text-stone-400"},"/",-1)),a(t(S),{variant:"outline",class:"bg-orange-100 text-orange-700 border-orange-300"},{default:n(()=>[...e[8]||(e[8]=[m("Komunitas",-1)])]),_:1})]),a(pe,{title:"Diskusi Komunitas",description:"Kelola topik diskusi umum untuk komunitas",icon:t(V),"icon-color":"bg-teal-500"},{actions:n(()=>[a(t(f),{onClick:e[0]||(e[0]=l=>N()),class:"gap-2"},{default:n(()=>[a(t(be),{class:"w-4 h-4"}),e[11]||(e[11]=m(" Buat Diskusi Baru ",-1))]),_:1})]),_:1},8,["icon"]),a(t(J),{class:"mb-6 border-2 border-blue-300 bg-blue-50"},{default:n(()=>[a(t(K),{class:"p-4"},{default:n(()=>[...e[12]||(e[12]=[s("p",{class:"text-sm text-blue-900"},[s("strong",null,"Catatan:"),m(" Hanya satu diskusi yang bisa aktif dalam satu waktu. Diskusi aktif akan ditampilkan di halaman utama dan semua user bisa memberikan balasan. ")],-1)])]),_:1})]),_:1}),A.value?(o(),r("div",ge,[s("div",{class:"absolute inset-0 bg-black/50",onClick:j}),s("div",he,[s("div",ye,[s("h2",we,d(b.value?"Edit Diskusi":"Buat Diskusi Baru"),1),s("button",{onClick:j,class:"p-1 hover:bg-stone-200"},[a(t(L),{class:"w-5 h-5"})])]),s("form",{onSubmit:se(q,["prevent"]),class:"p-6 space-y-4"},[s("div",null,[e[13]||(e[13]=s("label",{class:"block text-sm font-bold mb-2"},"Judul Diskusi *",-1)),a(t(te),{modelValue:v.value.title,"onUpdate:modelValue":e[1]||(e[1]=l=>v.value.title=l),placeholder:"Contoh: Apa Karya favorit kalian tahun ini?"},null,8,["modelValue"])]),s("div",null,[e[14]||(e[14]=s("label",{class:"block text-sm font-bold mb-2"},"Deskripsi (Opsional)",-1)),a(t(ae),{modelValue:v.value.description,"onUpdate:modelValue":e[2]||(e[2]=l=>v.value.description=l),placeholder:"Tambahkan konteks atau pertanyaan lebih detail...",class:"min-h-[100px] resize-none"},null,8,["modelValue"])]),s("div",Ce,[a(t(f),{type:"button",variant:"outline",class:"flex-1",onClick:j},{default:n(()=>[...e[15]||(e[15]=[m("Batal",-1)])]),_:1}),a(t(f),{type:"submit",class:"flex-1 gap-2",disabled:C.value},{default:n(()=>[C.value?(o(),_(t(z),{key:0,class:"w-4 h-4 animate-spin"})):(o(),_(t(le),{key:1,class:"w-4 h-4"})),m(" "+d(b.value?"Update":"Buat")+" Diskusi ",1)]),_:1},8,["disabled"])])],32)])])):F("",!0),a(t(J),null,{default:n(()=>[a(t(ie),{class:"bg-teal-50 border-b-2 border-stone-800"},{default:n(()=>[s("div",De,[a(t(V),{class:"w-5 h-5"}),a(t(oe),{class:"text-lg font-bold uppercase"},{default:n(()=>[...e[16]||(e[16]=[m("Daftar Diskusi",-1)])]),_:1})])]),_:1}),a(t(K),{class:"p-0"},{default:n(()=>[T.value?(o(),r("div",$e,[a(t(z),{class:"w-8 h-8 animate-spin text-stone-400"})])):w.value.length===0?(o(),r("div",Be,[a(t(V),{class:"w-12 h-12 mx-auto mb-2 opacity-50"}),e[17]||(e[17]=s("p",null,"Belum ada diskusi komunitas",-1))])):(o(!0),r(O,{key:2},P(w.value,l=>(o(),r("div",{key:l.discussion_id,class:"px-6 py-4 border-b border-stone-200 hover:bg-stone-50"},[s("div",je,[s("div",Fe,[s("div",Ve,[s("h3",ze,d(l.title),1),a(t(S),{variant:l.is_active?"default":"secondary",class:ue(l.is_active?"bg-green-100 text-green-700":"")},{default:n(()=>[m(d(l.is_active?"Aktif":"Nonaktif"),1)]),_:2},1032,["variant","class"])]),l.description?(o(),r("p",Te,d(l.description),1)):F("",!0),s("div",Ae,[s("span",null,"Dibuat oleh "+d(l.creator?.name),1),e[18]||(e[18]=s("span",null,"•",-1)),s("span",null,d(R(l.created_at)),1),e[19]||(e[19]=s("span",null,"•",-1)),s("button",{onClick:g=>Q(l),class:"text-brand-teal hover:underline font-medium"},d(l.reply_count||0)+" balasan ",9,Ee)])]),s("div",Ge,[a(t(f),{onClick:g=>I(l.discussion_id,l.is_active),size:"sm",variant:"outline",title:l.is_active?"Nonaktifkan":"Aktifkan"},{default:n(()=>[l.is_active?(o(),_(t(ce),{key:1,class:"w-4 h-4"})):(o(),_(t(de),{key:0,class:"w-4 h-4"}))]),_:2},1032,["onClick","title"]),a(t(f),{onClick:g=>N(l),size:"sm",variant:"outline",title:"Edit"},{default:n(()=>[a(t(ke),{class:"w-4 h-4"})]),_:1},8,["onClick"]),a(t(f),{onClick:g=>X(l),size:"sm",variant:"outline",class:"text-red-600 hover:bg-red-50",title:"Hapus"},{default:n(()=>[a(t(U),{class:"w-4 h-4"})]),_:1},8,["onClick"])])])]))),128))]),_:1})]),_:1}),y.value?(o(),r("div",He,[s("div",{class:"absolute inset-0 bg-black/50",onClick:e[3]||(e[3]=l=>y.value=!1)}),s("div",Me,[s("div",Ue,[a(t(ne),{class:"w-5 h-5 text-red-600"}),s("h2",Ne,d(H.value.title),1)]),s("div",Re,[s("p",Se,d(H.value.message),1),s("div",Ke,[a(t(f),{type:"button",variant:"outline",class:"flex-1",onClick:e[4]||(e[4]=l=>y.value=!1),disabled:h.value},{default:n(()=>[...e[20]||(e[20]=[m(" Batal ",-1)])]),_:1},8,["disabled"]),a(t(f),{type:"button",class:"flex-1 gap-2 bg-red-600 hover:bg-red-700",onClick:Y,disabled:h.value},{default:n(()=>[h.value?(o(),_(t(z),{key:0,class:"w-4 h-4 animate-spin"})):(o(),_(t(U),{key:1,class:"w-4 h-4"})),e[21]||(e[21]=m(" Hapus ",-1))]),_:1},8,["disabled"])])])])])):F("",!0),E.value?(o(),r("div",Je,[s("div",{class:"absolute inset-0 bg-black/50",onClick:M}),s("div",Le,[s("div",Oe,[s("div",null,[e[22]||(e[22]=s("h2",{class:"font-bold text-lg"},"Balasan Diskusi",-1)),s("p",Pe,d(D.value?.title),1)]),s("button",{onClick:M,class:"p-1 hover:bg-stone-200"},[a(t(L),{class:"w-5 h-5"})])]),s("div",qe,[G.value?(o(),r("div",Ie,[a(t(z),{class:"w-8 h-8 animate-spin text-stone-400"})])):k.value.length===0?(o(),r("div",Xe,[a(t(V),{class:"w-12 h-12 mx-auto mb-2 opacity-50"}),e[23]||(e[23]=s("p",null,"Belum ada balasan",-1))])):(o(),r("div",Ye,[(o(!0),r(O,null,P(k.value,l=>(o(),r("div",{key:l.reply_id,class:"flex gap-3 p-4 bg-stone-50 border-2 border-stone-200 hover:border-stone-300 transition-colors"},[s("div",Qe,[l.user?.image?(o(),r("img",{key:0,src:t(me)(l.user.image),alt:l.user.name,class:"w-full h-full object-cover",onError:e[5]||(e[5]=g=>g.target.style.display="none")},null,40,We)):(o(),_(t(ve),{key:1,class:"w-5 h-5 text-white"}))]),s("div",Ze,[s("div",es,[s("div",ss,[s("span",ts,d(l.user?.name||"User"),1),e[24]||(e[24]=s("span",{class:"text-stone-400"},"•",-1)),s("span",as,d(R(l.created_at)),1)]),a(t(f),{onClick:g=>W(l.reply_id),size:"sm",variant:"outline",class:"text-red-600 hover:bg-red-50",title:"Hapus balasan"},{default:n(()=>[a(t(U),{class:"w-4 h-4"})]),_:1},8,["onClick"])]),s("p",ls,d(l.content),1)])]))),128))]))]),s("div",is,[a(t(f),{onClick:M,variant:"outline",class:"w-full"},{default:n(()=>[...e[25]||(e[25]=[m(" Tutup ",-1)])]),_:1})])])])):F("",!0)])}}};export{cs as default};
