import{a4 as q,f as I,g as d,h as a,a as t,r as p,w as n,B as u,U as T,k as s,A,Y as w,z as g,c as P,n as y,S as Q,l as X,m as Y,R as K,v as Z,F as S,q as M,a8 as J,E as _,G as b,L as z,C as r,p as O,aA as W,aB as ee,D as te,t as V,H as se,T as ae,o,V as le,Z as ne,a2 as ie,$ as oe,ae as re}from"./index-Cb00d5qB.js";import{A as de}from"./SidebarAdmin-DJJB6J_v.js";import{F as ue}from"./funnel-BLnR4QwU.js";import{C as H}from"./calendar-CgMvX4Ns.js";import"./shield-F7nrhGlt.js";import"./file-text-dMjJK340.js";import"./settings-Db1aUZu5.js";const me={class:"min-h-screen bg-stone-100"},ce={class:"flex items-center gap-2 text-xs font-mono uppercase tracking-wider mb-4"},pe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},fe={class:"relative"},ve={class:"relative"},xe=["value"],ge={key:0,class:"flex flex-col items-center justify-center min-h-[400px]"},_e={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},be={class:"flex items-center justify-between"},ke={class:"text-2xl font-bold text-stone-900"},we={class:"flex items-center justify-between"},ye={class:"text-2xl font-bold text-stone-900"},he={class:"flex items-center justify-between"},Ce={class:"text-2xl font-bold text-stone-900"},$e={key:0,class:"text-center py-12"},je={key:1,class:"divide-y divide-stone-200"},Fe={class:"flex gap-4"},Be={class:"w-10 h-10 bg-brand-orange border-2 border-stone-800 shadow-brutal-sm flex items-center justify-center text-sm font-bold shrink-0"},Pe={class:"flex-1 min-w-0"},Se={class:"flex items-start justify-between gap-4 mb-2"},Ve={class:"flex-1 min-w-0"},Le={class:"flex items-center gap-2 flex-wrap mb-1"},Te={class:"font-bold text-stone-900"},Ae={class:"flex items-center gap-3 text-xs text-stone-500"},Ke={class:"flex items-center gap-1"},Me={key:0,class:"flex items-center gap-1"},ze={class:"flex items-center gap-2"},He={class:"mt-3 p-4 bg-stone-100 border-l-4 border-brand-teal"},Ue={class:"text-sm text-stone-700 whitespace-pre-wrap leading-relaxed"},De={key:0,class:"mt-2 text-xs text-stone-500 flex items-center gap-1"},Ne={key:0,class:"flex items-center justify-between mt-6"},Re={class:"text-sm text-stone-600"},Ee={class:"flex gap-2"},Oe={__name:"Comments",setup(Ge){const U=ae(),L=p(!1),h=p(!0),k=p(null),C=p([]),$=p([]),m=p({page:1,limit:20,total:0,totalPages:0}),v=p(""),f=p(""),c=p(1),{showToast:j}=se(),D=async()=>{try{const i=await V.get("/api/films",{params:{limit:1e3,status:"published"}});$.value=i.data||[]}catch(i){console.error("Failed to fetch films:",i)}},F=async()=>{h.value=!0;try{const i={page:c.value,limit:m.value.limit};f.value&&(i.film_id=f.value);const e=await V.get("/api/discussions/all",{params:i});e.success&&(C.value=e.data||[],m.value=e.pagination||m.value)}catch(i){console.error("Failed to fetch comments:",i),j("Gagal memuat komentar","error")}finally{h.value=!1}},N=async i=>{if(confirm("Hapus komentar ini? Semua balasan juga akan terhapus.")){k.value=i;try{await V.delete(`/api/discussions/${i}`),j("Komentar berhasil dihapus"),await F()}catch(e){console.error("Failed to delete comment:",e),j("Gagal menghapus komentar","error")}finally{k.value=null}}},B=O(()=>{if(!v.value.trim())return C.value;const i=v.value.toLowerCase();return C.value.filter(e=>e.isi_pesan?.toLowerCase().includes(i)||e.user?.name?.toLowerCase().includes(i)||e.film?.judul?.toLowerCase().includes(i))});q([f,c],()=>{F()},{immediate:!1});const R=i=>$.value.find(x=>x.film_id===i)?.judul||"Arsip tidak dikenal";return I(async()=>{await Promise.all([D(),F()])}),(i,e)=>{const x=T("router-link"),E=T("PageHeader");return o(),d("div",me,[a(de,{"onUpdate:collapsed":e[0]||(e[0]=l=>L.value=l)}),t("main",{class:te(["p-4 md:p-8 transition-all duration-300",L.value?"ml-14":"ml-56"])},[t("nav",ce,[a(x,{to:"/",class:"text-brand-teal hover:underline"},{default:n(()=>[...e[6]||(e[6]=[u("Beranda",-1)])]),_:1}),e[9]||(e[9]=t("span",{class:"text-stone-400"},"/",-1)),a(x,{to:"/admin",class:"text-stone-600 hover:underline"},{default:n(()=>[...e[7]||(e[7]=[u("Administrasi",-1)])]),_:1}),e[10]||(e[10]=t("span",{class:"text-stone-400"},"/",-1)),a(s(A),{variant:"outline",class:"bg-orange-100 text-orange-700 border-orange-300"},{default:n(()=>[...e[8]||(e[8]=[u("Komentar",-1)])]),_:1})]),a(E,{title:"Kelola Komentar",description:"Moderasi dan kelola semua komentar pengguna di platform.",icon:s(w),"icon-color":"bg-teal-500"},null,8,["icon"]),a(s(b),{class:"mb-6"},{default:n(()=>[a(s(g),{class:"p-4"},{default:n(()=>[t("div",pe,[t("div",fe,[a(s(Q),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-stone-400"}),a(s(X),{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=l=>v.value=l),placeholder:"Cari komentar...",class:"pl-10"},null,8,["modelValue"])]),t("div",ve,[a(s(K),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-stone-400"}),Y(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>f.value=l),class:"w-full pl-10 pr-4 py-2 border-2 border-stone-800 bg-white focus:outline-none focus:ring-0 font-body"},[e[11]||(e[11]=t("option",{value:""},"Semua Karya",-1)),(o(!0),d(S,null,M($.value,l=>(o(),d("option",{key:l.film_id,value:l.film_id},r(l.judul),9,xe))),128))],512),[[Z,f.value]])]),f.value||v.value?(o(),P(s(_),{key:0,variant:"outline",onClick:e[3]||(e[3]=l=>{f.value="",v.value=""}),class:"gap-2"},{default:n(()=>[a(s(J),{class:"w-4 h-4"}),e[12]||(e[12]=u(" Reset Filter ",-1))]),_:1})):y("",!0)])]),_:1})]),_:1}),h.value?(o(),d("div",ge,[a(s(z),{class:"w-12 h-12 animate-spin text-brand-teal mb-4"}),e[13]||(e[13]=t("p",{class:"text-stone-500 font-mono uppercase tracking-widest animate-pulse"},"Memuat komentar...",-1))])):(o(),d(S,{key:1},[t("div",_e,[a(s(b),null,{default:n(()=>[a(s(g),{class:"p-4"},{default:n(()=>[t("div",be,[t("div",null,[e[14]||(e[14]=t("p",{class:"text-xs font-bold uppercase tracking-wider text-stone-600 mb-1"},"Total Komentar",-1)),t("p",ke,r(m.value.total),1)]),a(s(w),{class:"w-8 h-8 text-brand-teal"})])]),_:1})]),_:1}),a(s(b),null,{default:n(()=>[a(s(g),{class:"p-4"},{default:n(()=>[t("div",we,[t("div",null,[e[15]||(e[15]=t("p",{class:"text-xs font-bold uppercase tracking-wider text-stone-600 mb-1"},"Ditampilkan",-1)),t("p",ye,r(B.value.length),1)]),a(s(ue),{class:"w-8 h-8 text-brand-orange"})])]),_:1})]),_:1}),a(s(b),null,{default:n(()=>[a(s(g),{class:"p-4"},{default:n(()=>[t("div",he,[t("div",null,[e[16]||(e[16]=t("p",{class:"text-xs font-bold uppercase tracking-wider text-stone-600 mb-1"},"Halaman",-1)),t("p",Ce,r(c.value)+" / "+r(m.value.totalPages),1)]),a(s(H),{class:"w-8 h-8 text-brand-red"})])]),_:1})]),_:1})]),a(s(b),null,{default:n(()=>[a(s(W),{class:"bg-brand-teal/10 border-b-2 border-stone-800"},{default:n(()=>[a(s(ee),{class:"flex items-center gap-2"},{default:n(()=>[a(s(w),{class:"w-5 h-5"}),e[17]||(e[17]=u(" Semua Komentar ",-1))]),_:1})]),_:1}),a(s(g),{class:"p-0"},{default:n(()=>[B.value.length===0?(o(),d("div",$e,[a(s(w),{class:"w-16 h-16 text-stone-300 mx-auto mb-4"}),e[18]||(e[18]=t("h3",{class:"text-lg font-bold text-stone-700 mb-1"},"Belum ada komentar yang ditampilkan",-1)),e[19]||(e[19]=t("p",{class:"text-stone-500 font-body mb-1"}," Tidak ada komentar yang cocok dengan filter saat ini. ",-1)),e[20]||(e[20]=t("p",{class:"text-sm text-stone-400"}," Coba reset filter, ubah kata kunci pencarian, atau periksa periode waktu yang berbeda. ",-1))])):(o(),d("div",je,[(o(!0),d(S,null,M(B.value,l=>(o(),d("div",{key:l.diskusi_id,class:"p-6 hover:bg-stone-50 transition-colors"},[t("div",Fe,[t("div",Be,r(l.user?.name?.charAt(0)||"U"),1),t("div",Pe,[t("div",Se,[t("div",Ve,[t("div",Le,[t("span",Te,r(l.user?.name||"Pengguna tidak dikenal"),1),a(s(A),{variant:"outline",class:"text-xs"},{default:n(()=>[a(s(le),{class:"w-3 h-3 mr-1"}),u(" "+r(l.user?.email||"Tidak ada email"),1)]),_:2},1024)]),t("div",Ae,[t("span",Ke,[a(s(H),{class:"w-3 h-3"}),u(" "+r(s(ne)(l.created_at,!0)),1)]),l.film?(o(),d("span",Me,[a(s(K),{class:"w-3 h-3"}),a(x,{to:`/archive/${l.film?.slug}`,class:"hover:text-brand-teal hover:underline"},{default:n(()=>[u(r(l.film?.judul||R(l.film_id)),1)]),_:2},1032,["to"])])):y("",!0)])]),t("div",ze,[a(s(_),{variant:"outline",size:"sm",onClick:G=>s(U).push(`/archive/${l.film?.slug}`),class:"gap-1"},{default:n(()=>[a(s(ie),{class:"w-3 h-3"}),e[21]||(e[21]=u(" Lihat ",-1))]),_:1},8,["onClick"]),a(s(_),{variant:"destructive",size:"sm",onClick:G=>N(l.diskusi_id),disabled:k.value===l.diskusi_id,class:"gap-1"},{default:n(()=>[k.value===l.diskusi_id?(o(),P(s(z),{key:0,class:"w-3 h-3 animate-spin"})):(o(),P(s(oe),{key:1,class:"w-3 h-3"})),e[22]||(e[22]=u(" Hapus ",-1))]),_:2},1032,["onClick","disabled"])])]),t("div",He,[t("p",Ue,r(l.isi_pesan),1)]),l.parent_id?(o(),d("div",De,[a(s(re),{class:"w-3 h-3"}),e[23]||(e[23]=t("span",null,"Ini adalah balasan dari komentar lain",-1))])):y("",!0)])])]))),128))]))]),_:1})]),_:1}),m.value.totalPages>1?(o(),d("div",Ne,[t("div",Re," Menampilkan "+r((c.value-1)*m.value.limit+1)+" sampai "+r(Math.min(c.value*m.value.limit,m.value.total))+" dari "+r(m.value.total)+" komentar ",1),t("div",Ee,[a(s(_),{variant:"outline",size:"sm",onClick:e[4]||(e[4]=l=>c.value--),disabled:c.value===1},{default:n(()=>[...e[24]||(e[24]=[u(" Sebelumnya ",-1)])]),_:1},8,["disabled"]),a(s(_),{variant:"outline",size:"sm",onClick:e[5]||(e[5]=l=>c.value++),disabled:c.value>=m.value.totalPages},{default:n(()=>[...e[25]||(e[25]=[u(" Berikutnya ",-1)])]),_:1},8,["disabled"])])])):y("",!0)],64))],2)])}}};export{Oe as default};
